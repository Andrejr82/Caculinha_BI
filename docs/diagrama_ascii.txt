================================================================================
                    CACULINHA BI AGENT PLATFORM — DIAGRAMA ASCII
================================================================================

                              ┌─────────────────┐
                              │     CLIENTE     │
                              │   (Browser/API) │
                              └────────┬────────┘
                                       │ HTTP/REST
                                       ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                              API LAYER (FastAPI)                             │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐             │
│  │AuthMiddle  │  │TenantMiddle│  │RateLimitMdl│  │ Endpoints  │             │
│  │   (JWT)    │  │   (Multi)  │  │  (Quota)   │  │  (REST)    │             │
│  └────────────┘  └────────────┘  └────────────┘  └────────────┘             │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ /api/v2/health  │ /api/v2/auth  │ /api/v2/chat  │ /api/v2/agents       ││
│  └─────────────────────────────────────────────────────────────────────────┘│
└──────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                          APPLICATION LAYER (Agents)                          │
│                                                                              │
│                        ┌─────────────────────────┐                          │
│                        │   ORCHESTRATOR AGENT    │                          │
│                        │   (Coordenador Central) │                          │
│                        └───────────┬─────────────┘                          │
│                                    │                                         │
│     ┌──────────────────────────────┼──────────────────────────────┐         │
│     │              │               │               │              │         │
│  ┌──▼───┐     ┌────▼────┐    ┌─────▼─────┐   ┌────▼────┐   ┌─────▼─────┐   │
│  │ SQL  │     │ Insight │    │ Forecast  │   │Metadata │   │ Tenant    │   │
│  │Agent │     │ Agent   │    │  Agent    │   │ Agent   │   │ Agent     │   │
│  └──┬───┘     └────┬────┘    └─────┬─────┘   └────┬────┘   └─────┬─────┘   │
│     │              │               │               │              │         │
│  ┌──▼───┐     ┌────▼────┐    ┌─────▼─────┐   ┌────▼────┐   ┌─────▼─────┐   │
│  │Secur │     │Monitor  │    │           │   │         │   │           │   │
│  │Agent │     │ Agent   │    │           │   │         │   │           │   │
│  └──────┘     └─────────┘    └───────────┘   └─────────┘   └───────────┘   │
└──────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                             DOMAIN LAYER                                      │
│                                                                              │
│  ┌─────────────────────┐  ┌─────────────────────┐  ┌─────────────────────┐  │
│  │      ENTITIES       │  │    VALUE OBJECTS    │  │       PORTS         │  │
│  │  ──────────────     │  │  ────────────────   │  │  ──────────────     │  │
│  │  • Agent            │  │  • TenantId         │  │  • LLMPort          │  │
│  │  • Conversation     │  │  • UserId           │  │  • DataSourcePort   │  │
│  │  • Insight          │  │  • MessageId        │  │  • CachePort        │  │
│  │  • Forecast         │  │  • TimeRange        │  │  • AuthPort         │  │
│  │  • Tenant           │  │                     │  │  • AgentPort        │  │
│  └─────────────────────┘  └─────────────────────┘  └─────────────────────┘  │
└──────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                         INFRASTRUCTURE LAYER                                  │
│                                                                              │
│  ┌─────────────────────────────────┐  ┌─────────────────────────────────┐   │
│  │         LLM ADAPTER             │  │        DATA ADAPTER             │   │
│  │  ───────────────────────────    │  │  ───────────────────────────    │   │
│  │  GeminiAdapter                  │  │  DuckDBAdapter                  │   │
│  │   └── implements LLMPort        │  │   └── implements DataSourcePort │   │
│  │                                 │  │                                 │   │
│  │  ┌─────────────────────────┐    │  │  ┌─────────────────────────┐    │   │
│  │  │    Google Gemini 2.5    │    │  │  │       DuckDB 1.1+       │    │   │
│  │  │    (gemini-2.5-flash)   │    │  │  │    (Parquet Files)      │    │   │
│  │  └─────────────────────────┘    │  │  └─────────────────────────┘    │   │
│  └─────────────────────────────────┘  └─────────────────────────────────┘   │
└──────────────────────────────────────────────────────────────────────────────┘
                                       │
                                       ▼
┌──────────────────────────────────────────────────────────────────────────────┐
│                           EXTERNAL SERVICES                                   │
│                                                                              │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐             │
│  │  Google Cloud   │  │   Parquet DB    │  │     Redis       │             │
│  │  (Gemini API)   │  │ (55 arquivos)   │  │ (Rate Limit)    │             │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘             │
└──────────────────────────────────────────────────────────────────────────────┘

================================================================================
                              FLUXO DE REQUISIÇÃO
================================================================================

  ┌────────┐    ┌─────┐    ┌────────┐    ┌────────────┐    ┌──────────┐
  │Cliente │───▶│Auth │───▶│Tenant  │───▶│RateLimit   │───▶│Endpoint  │
  └────────┘    │Check│    │Resolve │    │Check       │    │Handler   │
                └─────┘    └────────┘    └────────────┘    └────┬─────┘
                                                                 │
                                                                 ▼
  ┌────────┐    ┌─────────────┐    ┌──────────────┐    ┌────────────────┐
  │Response│◀───│InsightAgent │◀───│Orchestrator  │◀───│ProcessChatUseC │
  └────────┘    │(Narrative)  │    │(Route)       │    │(Validate)      │
                └─────────────┘    └──────────────┘    └────────────────┘

================================================================================
                                LEGENDA
================================================================================

  ───▶  Fluxo de dados
  │     Conexão vertical
  ─     Conexão horizontal
  └──   Implementação/Herança
  
  [Agents]     = Agentes de IA especializados
  [Ports]      = Interfaces abstratas (contratos)
  [Adapters]   = Implementações concretas

================================================================================
