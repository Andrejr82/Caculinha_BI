import{a as _,o as wt,t as f,i,c as a,z as Dt,S as C,D as st,F as Rt,f as kt,d as g,l as yt,e as Tt,g as Lt}from"./index-BTwf99OE.js";import{R as it}from"./refresh-cw-BvDo3NQr.js";import{F as Et}from"./filter-CmxAUFBN.js";import{P as jt}from"./package-DVlwFfH0.js";var Ut=f('<div class="card p-4 border-red-500 bg-red-500/10"><p class=text-red-500>'),Nt=f('<div class="flex-1 flex items-center justify-center"><div class=text-center><p class=text-muted>Carregando relatórios...'),Ot=f('<div class=overflow-x-auto><table class=w-full><thead class=bg-muted/50><tr class="text-left text-xs font-medium text-muted uppercase"><th class=p-3>ID</th><th class=p-3>Tipo</th><th class=p-3>Transferências</th><th class=p-3>Solicitante</th><th class=p-3>Data/Hora</th><th class="p-3 text-right">Ações</th></tr></thead><tbody class=divide-y>'),zt=f('<div class="card border"><div class="p-4 border-b"><h3 class=font-semibold>Histórico (<!> <!>)'),Ft=f('<div class="flex flex-col p-6 gap-6"><div class="flex justify-between items-end"><div><h2 class="text-2xl font-bold flex items-center gap-2">Relatórios de Transferências</h2><p class=text-muted>Histórico de solicitações de transferências entre UNEs</p></div><button class="btn btn-outline gap-2">Atualizar</button></div><div class="card p-4 border"><div class="flex items-center gap-2 mb-4"><h3 class=font-semibold>Filtros</h3></div><div class="flex gap-2 mb-4"><button class="btn btn-outline text-sm">Últimos 7 dias</button><button class="btn btn-outline text-sm">Últimos 30 dias</button><button class="btn btn-outline text-sm">Últimos 90 dias</button></div><div class="grid grid-cols-1 md:grid-cols-4 gap-3"><input type=date class=input placeholder="Data Início"><input type=date class=input placeholder="Data Fim"><input type=text class=input placeholder="Buscar por solicitante ou ID..."><button class="btn btn-primary">Aplicar Filtros</button></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div class="card p-4 border"><div class="text-sm text-muted mb-1">Total de Solicitações</div><div class="text-2xl font-bold"></div></div><div class="card p-4 border"><div class="text-sm text-muted mb-1">Total de Transferências</div><div class="text-2xl font-bold"></div></div><div class="card p-4 border"><div class="text-sm text-muted mb-1">Ações</div><button class="btn btn-outline w-full gap-2 text-sm">Exportar Tudo (CSV)'),At=f('<div class="p-12 text-center text-muted"><p>Nenhuma solicitação encontrada</p><p class="text-sm mt-2">Ajuste os filtros ou crie uma nova transferência'),It=f('<tr class="hover:bg-muted/30 transition-colors"><td class="p-3 font-mono text-xs"></td><td class=p-3><span></span></td><td class="p-3 font-semibold"></td><td class="p-3 text-sm"></td><td class="p-3 text-sm font-mono text-muted"></td><td class="p-3 text-right"><button class="btn btn-outline btn-sm gap-2">JSON');function Jt(){const[w,lt]=_([]),[p,O]=_(!0),[z,F]=_(null),[D,A]=_(""),[R,I]=_(""),[k,at]=_(""),$=async()=>{O(!0),F(null);try{const t=new URLSearchParams;D()&&t.append("start_date",D()),R()&&t.append("end_date",R());const l=await yt.get(`/transfers/report?${t.toString()}`);lt(l.data)}catch(t){console.error("Erro ao carregar relatórios:",t),F(t.response?.data?.detail||"Erro ao carregar relatórios")}finally{O(!1)}},nt=t=>{const l=JSON.stringify(t,null,2),r=new Blob([l],{type:"application/json"}),m=URL.createObjectURL(r),o=document.createElement("a");o.href=m;const d=t.batch_id||t.transfer_id||"transfer-report";o.download=`${d}.json`,o.click(),URL.revokeObjectURL(m)},rt=()=>{const t=[];if(w().forEach(s=>{s.transferencias?s.transferencias.forEach(x=>{t.push({...x,solicitante:s.solicitante_id,timestamp:s.timestamp,batch_id:s.batch_id})}):t.push({produto_id:s.produto_id,une_origem:s.une_origem,une_destino:s.une_destino,quantidade:s.quantidade,solicitante:s.solicitante_id,timestamp:s.timestamp,transfer_id:s.transfer_id})}),t.length===0){alert("Nenhuma transferência para exportar");return}const r=[["Produto ID","UNE Origem","UNE Destino","Quantidade","Solicitante","Data/Hora","ID"].join(","),...t.map(s=>[s.produto_id,s.une_origem,s.une_destino,s.quantidade,s.solicitante,s.timestamp,s.batch_id||s.transfer_id||""].join(","))].join(`
`),m=new Blob([r],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(m),d=document.createElement("a");d.href=o,d.download=`transferencias-${new Date().toISOString().split("T")[0]}.csv`,d.click(),URL.revokeObjectURL(o)},b=()=>k()?w().filter(t=>{const l=k().toLowerCase();return t.solicitante_id?.toLowerCase().includes(l)||t.batch_id?.toLowerCase().includes(l)||t.transfer_id?.toLowerCase().includes(l)}):w(),y=t=>{const l=new Date,r=new Date;r.setDate(r.getDate()-t),I(l.toISOString().split("T")[0]),A(r.toISOString().split("T")[0]),$()};return wt(()=>{$()}),(()=>{var t=Ft(),l=t.firstChild,r=l.firstChild,m=r.firstChild,o=m.firstChild,d=r.nextSibling,s=d.firstChild,x=l.nextSibling,T=x.firstChild,dt=T.firstChild,B=T.nextSibling,H=B.firstChild,P=H.nextSibling,ct=P.nextSibling,ot=B.nextSibling,L=ot.firstChild,E=L.nextSibling,j=E.nextSibling,q=j.nextSibling,J=x.nextSibling,Q=J.firstChild,ut=Q.firstChild,bt=ut.nextSibling,V=Q.nextSibling,mt=V.firstChild,ft=mt.nextSibling,ht=V.nextSibling,_t=ht.firstChild,v=_t.nextSibling,pt=v.firstChild;return i(m,a(Dt,{size:28}),o),d.$$click=$,i(d,a(it,{size:16,get class(){return p()?"animate-spin":""}}),s),i(T,a(Et,{size:20}),dt),H.$$click=()=>y(7),P.$$click=()=>y(30),ct.$$click=()=>y(90),L.$$input=e=>A(e.currentTarget.value),E.$$input=e=>I(e.currentTarget.value),j.$$input=e=>at(e.currentTarget.value),q.$$click=$,i(t,a(C,{get when(){return z()},get children(){var e=Ut(),n=e.firstChild;return i(n,z),e}}),J),i(bt,()=>b().length),i(ft,()=>b().reduce((e,n)=>e+(n.total_transferencias||1),0)),v.$$click=rt,i(v,a(st,{size:16}),pt),i(t,a(C,{get when(){return p()},get children(){var e=Nt(),n=e.firstChild,u=n.firstChild;return i(n,a(it,{size:48,class:"mx-auto mb-4 opacity-50 animate-spin"}),u),e}}),null),i(t,a(C,{get when(){return!p()},get children(){var e=zt(),n=e.firstChild,u=n.firstChild,S=u.firstChild,M=S.nextSibling,gt=M.nextSibling,G=gt.nextSibling;return G.nextSibling,i(u,()=>b().length,M),i(u,()=>b().length===1?"solicitação":"solicitações",G),i(e,a(C,{get when(){return b().length>0},get fallback(){return(()=>{var h=At(),U=h.firstChild;return i(h,a(jt,{size:48,class:"mx-auto mb-4 opacity-20"}),U),h})()},get children(){var h=Ot(),U=h.firstChild,$t=U.firstChild,xt=$t.nextSibling;return i(xt,a(Rt,{get each(){return b()},children:c=>(()=>{var K=It(),W=K.firstChild,X=W.nextSibling,Y=X.firstChild,Z=X.nextSibling,tt=Z.nextSibling,et=tt.nextSibling,vt=et.nextSibling,N=vt.firstChild,St=N.firstChild;return i(W,()=>c.batch_id||c.transfer_id||"N/A"),i(Y,(()=>{var Ct=kt(()=>!!c.batch_id);return()=>Ct()?`Lote (${c.modo})`:"Simples"})()),i(Z,()=>c.total_transferencias||1),i(tt,()=>c.solicitante_id),i(et,()=>new Date(c.timestamp).toLocaleString("pt-BR")),N.$$click=()=>nt(c),i(N,a(st,{size:14}),St),g(()=>Tt(Y,`px-2 py-1 text-xs rounded ${c.batch_id?"bg-blue-500/10 text-blue-400":"bg-green-500/10 text-green-400"}`)),K})()})),h}}),null),e}}),null),g(e=>{var n=p(),u=p(),S=b().length===0;return n!==e.e&&(d.disabled=e.e=n),u!==e.t&&(q.disabled=e.t=u),S!==e.a&&(v.disabled=e.a=S),e},{e:void 0,t:void 0,a:void 0}),g(()=>L.value=D()),g(()=>E.value=R()),g(()=>j.value=k()),t})()}Lt(["click","input"]);export{Jt as default};
