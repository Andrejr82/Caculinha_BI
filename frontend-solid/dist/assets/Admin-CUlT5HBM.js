import{c as s,m as ye,I as we,a as E,b as oe,t as o,i as e,f as P,C as Se,d as g,S as x,P as Ce,F as de,T as ke,X as Ue,Q as T,e as A,k as ze,g as Ee,y as Te}from"./index-BTwf99OE.js";import{A as Ae}from"./alert-circle-vl5fvNJb.js";import{R as ee}from"./refresh-cw-BvDo3NQr.js";import{U as qe}from"./users-BU7OZROo.js";import{P as Me}from"./plus-CHdX88I_.js";const Pe=[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]],je=y=>s(we,ye(y,{name:"PenSquare",iconNode:Pe}));var Ne=o("<div>"),De=o('<div class="max-w-2xl mx-auto space-y-4"><div><div class="p-3 bg-purple-500/10 text-purple-400 rounded-lg"></div><div class=flex-1><h4 class="font-semibold text-lg">Sincronizar Dados</h4><p class="text-sm text-muted">Atualizar Parquet via SQL Server'),Le=o('<tr><td colspan=6 class="text-center p-8 text-muted">Carregando usuários...'),Re=o('<tr><td colspan=6 class="text-center p-8 text-muted">Nenhum usuário encontrado'),Fe=o('<div class=space-y-4><div class="flex justify-between items-center"><h3 class="text-lg font-semibold">Gerenciar Usuários</h3><button class="btn btn-primary gap-2">Novo Usuário</button></div><div class="border rounded-lg overflow-hidden bg-card"><table class=w-full><thead class="bg-muted/50 border-b"><tr><th class="text-left p-3 text-sm font-medium">Username</th><th class="text-left p-3 text-sm font-medium">Email</th><th class="text-left p-3 text-sm font-medium">Role</th><th class="text-left p-3 text-sm font-medium">Segmentos</th><th class="text-center p-3 text-sm font-medium">Status</th><th class="text-right p-3 text-sm font-medium">Ações</th></tr></thead><tbody>'),Ie=o('<p class="text-xs text-muted">Nenhum segmento disponível encontrado.'),Ge=o('<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"><div class="bg-card border rounded-lg max-w-md w-full p-6 space-y-4 max-h-[90vh] overflow-y-auto"><div class="flex justify-between items-center"><h3 class="text-lg font-semibold"></h3><button class="p-1 hover:bg-secondary rounded"></button></div><form class=space-y-4><div><label class="block text-sm font-medium mb-1">Username</label><input type=text class="w-full px-3 py-2 bg-background border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"required></div><div><label class="block text-sm font-medium mb-1">Email</label><input type=email class="w-full px-3 py-2 bg-background border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"required></div><div><label class="block text-sm font-medium mb-1">Senha </label><input type=password class="w-full px-3 py-2 bg-background border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"minlength=8></div><div><label class="block text-sm font-medium mb-1">Role</label><select class="w-full px-3 py-2 bg-background border rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"required><option value=viewer>Viewer</option><option value=user>User</option><option value=admin>Admin</option></select></div><div class=space-y-2><label class="block text-sm font-medium">Segmentos Permitidos</label><div class="border rounded-lg p-3 max-h-48 overflow-y-auto space-y-2 bg-background"></div><p class="text-xs text-muted"></p></div><div class="flex gap-2 pt-4"><button type=button class="flex-1 btn btn-outline">Cancelar</button><button type=submit class="flex-1 btn btn-primary">'),Oe=o('<div class="flex flex-col p-6 gap-6"><div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4"><div><h2 class="text-2xl font-bold tracking-tight">Área Administrativa</h2><p class=text-muted>Gerenciamento do sistema e usuários</p></div></div><div class="flex gap-2 border-b"><button><div class="flex items-center gap-2">Sincronização</div></button><button><div class="flex items-center gap-2">Usuários</div></button></div><div class="flex-1 overflow-auto">'),Qe=o('<span class="text-sm text-primary animate-pulse">Processando...'),Ve=o('<span class="text-muted italic">Todos (Admin)'),He=o('<tr class="border-b hover:bg-muted/30 transition-colors"><td class=p-3></td><td class="p-3 text-sm text-muted"></td><td class=p-3><span></span></td><td class="p-3 text-sm text-muted"></td><td class="p-3 text-center"><button></button></td><td class=p-3><div class="flex justify-end gap-2"><button class="p-2 hover:bg-secondary rounded transition-colors"title=Editar></button><button class="p-2 hover:bg-red-500/10 text-red-400 rounded transition-colors"title=Excluir>'),Xe=o("<span> segmento(s)"),Ze=o('<span class="text-yellow-500 text-xs">Nenhum'),Be=o('<span class="text-xs text-muted">Carregando segmentos...'),Je=o('<label class="flex items-center gap-2 text-sm cursor-pointer hover:bg-muted/50 p-1 rounded"><input type=checkbox class="checkbox checkbox-sm checkbox-primary"><span>');function st(){const[y,te]=E(!1),[j,l]=E(null),[N,se]=E("sync"),[h,{refetch:H}]=oe(async()=>{try{return(await T.getUsers()).data}catch(t){return console.error("Error loading users:",t),[]}}),[X]=oe(async()=>{try{return(await Te.getFilterOptions()).data}catch(t){return console.error("Error loading filter options:",t),{categorias:[],segmentos:[]}}}),[ce,Z]=E(!1),[w,B]=E(null),[d,b]=E({username:"",email:"",password:"",role:"user",allowed_segments:[]}),ue=async()=>{te(!0),l(null);try{await T.syncParquet(),l({type:"success",text:"Sincronização iniciada em segundo plano!"})}catch{l({type:"error",text:"Erro ao iniciar sincronização. Verifique logs."})}finally{te(!1),setTimeout(()=>l(null),5e3)}},me=()=>{B(null),b({username:"",email:"",password:"",role:"user",allowed_segments:[]}),Z(!0)},ge=t=>{B(t),b({username:t.username,email:t.email,password:"",role:t.role,allowed_segments:t.allowed_segments||[]}),Z(!0)},D=()=>{Z(!1),B(null),b({username:"",email:"",password:"",role:"user",allowed_segments:[]})},pe=async t=>{t.preventDefault(),l(null);try{const i=d();if(w()){const u={username:i.username,email:i.email,role:i.role,allowed_segments:i.allowed_segments};i.password&&(u.password=i.password),await T.updateUser(w().id,u),l({type:"success",text:`Usuário ${i.username} atualizado com sucesso!`})}else await T.createUser(i),l({type:"success",text:`Usuário ${i.username} criado com sucesso!`});D(),H(),setTimeout(()=>l(null),5e3)}catch(i){const u=i?.response?.data?.detail||"Erro ao salvar usuário";l({type:"error",text:u}),setTimeout(()=>l(null),5e3)}},xe=async t=>{if(confirm(`Tem certeza que deseja excluir o usuário ${t.username}?`)){l(null);try{await T.deleteUser(t.id),l({type:"success",text:`Usuário ${t.username} excluído com sucesso!`}),H(),setTimeout(()=>l(null),5e3)}catch(i){const u=i?.response?.data?.detail||"Erro ao excluir usuário";l({type:"error",text:u}),setTimeout(()=>l(null),5e3)}}},be=async t=>{l(null);try{await T.updateUser(t.id,{is_active:!t.is_active}),l({type:"success",text:`Usuário ${t.username} ${t.is_active?"desativado":"ativado"} com sucesso!`}),H(),setTimeout(()=>l(null),5e3)}catch(i){const u=i?.response?.data?.detail||"Erro ao atualizar status do usuário";l({type:"error",text:u}),setTimeout(()=>l(null),5e3)}};return(()=>{var t=Oe(),i=t.firstChild,u=i.nextSibling,L=u.firstChild,re=L.firstChild,fe=re.firstChild,J=L.nextSibling,le=J.firstChild,he=le.firstChild,ne=u.nextSibling;return e(t,s(x,{get when(){return j()},get children(){var n=Ne();return e(n,(()=>{var a=P(()=>j()?.type==="success");return()=>a()?s(Se,{size:16}):s(Ae,{size:16})})(),null),e(n,()=>j()?.text,null),g(()=>A(n,`p-3 rounded-lg flex items-center gap-2 text-sm ${j()?.type==="success"?"bg-green-500/10 text-green-400 border border-green-500/20":"bg-red-500/10 text-red-400 border border-red-500/20"}`)),n}}),u),L.$$click=()=>se("sync"),e(re,s(ee,{size:16}),fe),J.$$click=()=>se("users"),e(le,s(qe,{size:16}),he),e(ne,s(x,{get when(){return N()==="sync"},get children(){var n=De(),a=n.firstChild,p=a.firstChild;return p.nextSibling,Ce(a,"click",y()?void 0:ue,!0),e(p,s(ee,{size:24,get class(){return y()?"animate-spin":""}})),e(a,(()=>{var f=P(()=>!!y());return()=>f()&&Qe()})(),null),g(()=>A(a,`p-6 border rounded-lg bg-card flex items-center gap-4 transition-all ${y()?"opacity-70 cursor-wait":"hover:border-primary/50 cursor-pointer hover:bg-secondary/30"}`)),n}}),null),e(ne,s(x,{get when(){return N()==="users"},get children(){var n=Fe(),a=n.firstChild,p=a.firstChild,f=p.nextSibling,R=f.firstChild,F=a.nextSibling,I=F.firstChild,K=I.firstChild,S=K.nextSibling;return f.$$click=me,e(f,s(Me,{size:16}),R),e(S,s(x,{get when(){return h.loading},get children(){var r=Le(),v=r.firstChild,$=v.firstChild;return e(v,s(ee,{size:24,class:"animate-spin mx-auto mb-2"}),$),r}}),null),e(S,s(x,{get when(){return P(()=>!h.loading)()&&h()},get children(){return s(de,{get each(){return h()},children:r=>(()=>{var v=He(),$=v.firstChild,q=$.nextSibling,C=q.nextSibling,k=C.firstChild,M=C.nextSibling,G=M.nextSibling,U=G.firstChild,O=G.nextSibling,W=O.firstChild,z=W.firstChild,Q=z.nextSibling;return e($,()=>r.username),e(q,()=>r.email),e(k,()=>r.role),e(M,s(x,{get when(){return r.role==="admin"},get fallback(){return P(()=>!!(r.allowed_segments&&r.allowed_segments.length>0))()?(()=>{var m=Xe(),_=m.firstChild;return e(m,()=>r.allowed_segments.length,_),g(()=>ze(m,"title",r.allowed_segments.join(", "))),m})():Ze()},get children(){return Ve()}})),U.$$click=()=>be(r),e(U,()=>r.is_active?"Ativo":"Inativo"),z.$$click=()=>ge(r),e(z,s(je,{size:16})),Q.$$click=()=>xe(r),e(Q,s(ke,{size:16})),g(m=>{var _=`px-2 py-1 rounded text-xs font-medium ${r.role==="admin"?"bg-purple-500/10 text-purple-400":r.role==="user"?"bg-blue-500/10 text-blue-400":"bg-gray-500/10 text-gray-400"}`,V=`px-2 py-1 rounded text-xs font-medium transition-colors ${r.is_active?"bg-green-500/10 text-green-400 hover:bg-green-500/20":"bg-red-500/10 text-red-400 hover:bg-red-500/20"}`;return _!==m.e&&A(k,m.e=_),V!==m.t&&A(U,m.t=V),m},{e:void 0,t:void 0}),v})()})}}),null),e(S,s(x,{get when(){return P(()=>!h.loading)()&&(!h()||h()?.length===0)},get children(){return Re()}}),null),n}}),null),e(t,s(x,{get when(){return ce()},get children(){var n=Ge(),a=n.firstChild,p=a.firstChild,f=p.firstChild,R=f.nextSibling,F=p.nextSibling,I=F.firstChild,K=I.firstChild,S=K.nextSibling,r=I.nextSibling,v=r.firstChild,$=v.nextSibling,q=r.nextSibling,C=q.firstChild;C.firstChild;var k=C.nextSibling,M=q.nextSibling,G=M.firstChild,U=G.nextSibling,O=M.nextSibling,W=O.firstChild,z=W.nextSibling,Q=z.nextSibling,m=O.nextSibling,_=m.firstChild,V=_.nextSibling;return n.$$click=D,a.$$click=c=>c.stopPropagation(),e(f,()=>w()?"Editar Usuário":"Novo Usuário"),R.$$click=D,e(R,s(Ue,{size:20})),F.addEventListener("submit",pe),S.$$input=c=>b({...d(),username:c.currentTarget.value}),$.$$input=c=>b({...d(),email:c.currentTarget.value}),e(C,()=>w()&&"(deixe em branco para não alterar)",null),k.$$input=c=>b({...d(),password:c.currentTarget.value}),U.addEventListener("change",c=>b({...d(),role:c.currentTarget.value})),e(z,s(x,{get when(){return!X.loading},get fallback(){return Be()},get children(){return[s(de,{get each(){return X()?.segmentos||[]},children:c=>(()=>{var ie=Je(),Y=ie.firstChild,ve=Y.nextSibling;return Y.addEventListener("change",$e=>{const ae=d().allowed_segments||[];$e.currentTarget.checked?b({...d(),allowed_segments:[...ae,c]}):b({...d(),allowed_segments:ae.filter(_e=>_e!==c)})}),e(ve,c),g(()=>Y.checked=d().allowed_segments?.includes(c)),ie})()}),s(x,{get when(){return!X()?.segmentos?.length},get children(){return Ie()}})]}})),e(Q,()=>d().role==="admin"?"Admin tem acesso total independente desta seleção.":"Se nenhum selecionado, o usuário não verá dados."),_.$$click=D,e(V,()=>w()?"Salvar":"Criar"),g(()=>k.required=!w()),g(()=>S.value=d().username),g(()=>$.value=d().email),g(()=>k.value=d().password),g(()=>U.value=d().role),n}}),null),g(n=>{var a=`px-4 py-2 font-medium transition-colors ${N()==="sync"?"border-b-2 border-primary text-primary":"text-muted hover:text-foreground"}`,p=`px-4 py-2 font-medium transition-colors ${N()==="users"?"border-b-2 border-primary text-primary":"text-muted hover:text-foreground"}`;return a!==n.e&&A(L,n.e=a),p!==n.t&&A(J,n.t=p),n},{e:void 0,t:void 0}),t})()}Ee(["click","input"]);export{st as default};
