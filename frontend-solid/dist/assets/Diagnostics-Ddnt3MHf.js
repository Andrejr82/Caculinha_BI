import{c as s,m as Q,I as B,a as S,o as se,t as o,i as e,A as R,S as h,d as y,_ as re,f as A,C as W,z as le,F as ne,e as w,k as ae,g as ie}from"./index-BTwf99OE.js";import{R as H}from"./refresh-cw-BvDo3NQr.js";import{S as oe,P as X}from"./settings-qjvp6htu.js";const de=[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]],ce=d=>s(B,Q(d,{name:"Activity",iconNode:de})),ue=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],me=d=>s(B,Q(d,{name:"HardDrive",iconNode:ue})),ge=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],fe=d=>s(B,Q(d,{name:"Server",iconNode:ge}));var be=o('<div class="p-4 bg-red-500/10 border border-red-500/30 rounded-lg text-red-300 flex items-center gap-3"><div><h3 class=font-bold>Erro ao carregar diagnóstico</h3><p class="text-sm opacity-80">'),xe=o('<div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div class="p-6 rounded-lg border bg-card"><div class="flex items-center justify-between mb-4"><span class="text-sm font-medium text-muted-foreground">Parquet (Dados)</span></div><div class="flex flex-col gap-2"></div></div><div class="p-6 rounded-lg border bg-card"><div class="flex items-center justify-between mb-4"><span class="text-sm font-medium text-muted-foreground">SQL Server</span></div><div class="flex flex-col gap-2"></div></div><div class="p-6 rounded-lg border bg-card"><div class="flex items-center justify-between mb-4"><span class="text-sm font-medium text-muted-foreground">Supabase Auth</span></div><div class="flex flex-col gap-2">'),pe=o('<div><label class="text-xs text-muted-foreground font-medium">Servidor SQL</label><p class="font-mono text-sm mt-1 p-2 bg-secondary rounded">'),he=o('<div><label class="text-xs text-muted-foreground font-medium">Banco de Dados</label><p class="font-mono text-sm mt-1 p-2 bg-secondary rounded">'),ve=o('<div><label class="text-xs text-muted-foreground font-medium">Usuário SQL</label><p class="font-mono text-sm mt-1 p-2 bg-secondary rounded">'),_e=o('<div><label class="text-xs text-muted-foreground font-medium">Supabase URL</label><p class="font-mono text-sm mt-1 p-2 bg-secondary rounded truncate">'),$e=o('<div class="p-6 rounded-lg border bg-card"><h3 class="font-semibold flex items-center gap-2 mb-4">Configurações Detectadas</h3><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="text-xs text-muted-foreground font-medium">Modo de Operação</label><p class="font-mono text-sm mt-1 p-2 bg-secondary rounded"></p></div><div><label class="text-xs text-muted-foreground font-medium">Path Parquet</label><p class="font-mono text-xs mt-1 p-2 bg-secondary rounded truncate">'),ye=o('<p class="text-sm text-muted-foreground mt-2">Versão: <span class=font-mono>'),Ce=o('<div class=mt-3><p class="text-sm font-medium mb-2 flex items-center gap-2">Tabelas Disponíveis (<!>)</p><div class="max-h-48 overflow-y-auto bg-secondary/50 rounded p-2"><div class="grid grid-cols-2 md:grid-cols-3 gap-1">'),Se=o('<div><div class="flex items-start gap-3"><div class=flex-1><p>'),we=o('<div class="p-6 rounded-lg border bg-card"><div class="flex justify-between items-center mb-4"><h3 class="font-semibold flex items-center gap-2">Teste de Conexão SQL Server</h3><button class="btn btn-primary gap-2">'),ke=o('<div class="p-6 bg-blue-500/5 border border-blue-500/20 rounded-lg"><h4 class="font-semibold text-blue-500 mb-3">Modo Cloud (Apenas Parquet)</h4><p class="text-sm text-muted-foreground mb-3">O sistema está rodando em modo cloud, usando apenas arquivos Parquet como fonte de dados. Este é o modo recomendado para deploy em Streamlit Cloud ou ambientes sem SQL Server.</p><ul class="text-sm text-muted-foreground space-y-1 list-disc list-inside"><li>Autenticação: Parquet (users.parquet) ou Supabase</li><li>Dados analíticos: Parquet (admmat.parquet)</li><li>Performance: Otimizado para leitura em cache</li><li>Deploy: Compatível com Streamlit Cloud'),ze=o('<div class="flex flex-col h-full p-6 gap-6 max-w-7xl mx-auto"><div class="flex justify-between items-start"><div><h2 class="text-2xl font-bold tracking-tight flex items-center gap-2">Diagnóstico do Sistema</h2><p class="text-muted mt-1">Configurações e status das conexões de banco de dados</p></div><button class="btn btn-outline gap-2">Atualizar'),qe=o('<div class="p-12 text-center border rounded-xl bg-card text-muted animate-pulse">Carregando informações do sistema...'),M=o("<span>"),Ae=o('<p class="text-xs text-muted-foreground mt-2">Tamanho: <span class="font-mono font-medium"> MB'),De=o('<span class="text-xs font-mono p-1 hover:bg-secondary rounded">');function Le(){const[d,Y]=S(null),[f,Z]=S(null),[u,D]=S(null),[E,O]=S(!0),[F,U]=S(!1),[K,V]=S(null),G=async()=>{O(!0),V(null);try{const l=sessionStorage.getItem("token");if(!l)throw new Error("Token não encontrado. Faça login novamente.");const[_,$]=await Promise.all([fetch("/api/v1/diagnostics/db-status",{headers:{Authorization:`Bearer ${l}`}}),fetch("/api/v1/diagnostics/config",{headers:{Authorization:`Bearer ${l}`}})]);if(!_.ok||!$.ok)throw new Error("Erro ao buscar informações de diagnóstico");const k=await _.json(),N=await $.json();Y(k),Z(N)}catch(l){console.error("Erro ao carregar diagnóstico:",l),V(l.message||"Erro ao conectar com o backend")}finally{O(!1)}},ee=async()=>{U(!0),D(null);try{const l=sessionStorage.getItem("token");if(!l)throw new Error("Token não encontrado");const _=await fetch("/api/v1/diagnostics/test-connection",{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"}});if(!_.ok)throw new Error("Erro ao testar conexão");const $=await _.json();D($)}catch(l){D({success:!1,message:l.message||"Erro ao testar conexão",version:null,tables:null})}finally{U(!1)}};se(()=>{G()});const P=l=>l==="ok"||l==="enabled"?"text-green-500 bg-green-500/10 border-green-500/30":l==="disabled"?"text-yellow-500 bg-yellow-500/10 border-yellow-500/30":"text-red-500 bg-red-500/10 border-red-500/30",T=l=>l==="ok"||l==="enabled"?W:R,L=l=>l==="ok"?"OK":l==="enabled"?"Habilitado":l==="disabled"?"Desabilitado":"Erro";return(()=>{var l=ze(),_=l.firstChild,$=_.firstChild,k=$.firstChild,N=k.firstChild,z=$.nextSibling,te=z.firstChild;return e(k,s(ce,{size:24}),N),z.$$click=G,e(z,s(H,{size:16,get class(){return E()?"animate-spin":""}}),te),e(l,s(h,{get when(){return K()},get children(){var i=be(),c=i.firstChild,m=c.firstChild,x=m.nextSibling;return e(i,s(R,{size:24}),c),e(x,K),i}}),null),e(l,s(h,{get when(){return A(()=>!!(!E()&&d()))()&&f()},get fallback(){return(()=>{var i=qe(),c=i.firstChild;return e(i,s(H,{class:"animate-spin mx-auto mb-4",size:32}),c),i})()},get children(){return[(()=>{var i=xe(),c=i.firstChild,m=c.firstChild;m.firstChild;var x=m.nextSibling,p=c.nextSibling,g=p.firstChild;g.firstChild;var C=g.nextSibling,b=p.nextSibling,v=b.firstChild;v.firstChild;var a=v.nextSibling;return e(m,s(me,{size:18,class:"text-blue-500"}),null),e(x,()=>{const t=d()?.parquet.status||"unknown",n=T(t);return[(()=>{var r=M();return e(r,s(n,{size:16}),null),e(r,()=>L(t),null),y(()=>w(r,`inline-flex items-center gap-2 rounded border px-3 py-1.5 text-sm font-medium ${P(t)}`)),r})(),(()=>{var r=Ae(),j=r.firstChild,q=j.nextSibling,I=q.firstChild;return e(q,()=>d()?.parquet.size_mb,I),r})()]}),e(g,s(re,{size:18,class:"text-orange-500"}),null),e(C,()=>{const t=d()?.sql_server.status||"unknown",n=T(t);return(()=>{var r=M();return e(r,s(n,{size:16}),null),e(r,()=>L(t),null),y(()=>w(r,`inline-flex items-center gap-2 rounded border px-3 py-1.5 text-sm font-medium ${P(t)}`)),r})()}),e(v,s(fe,{size:18,class:"text-green-500"}),null),e(a,()=>{const t=d()?.supabase.status||"unknown",n=T(t);return(()=>{var r=M();return e(r,s(n,{size:16}),null),e(r,()=>L(t),null),y(()=>w(r,`inline-flex items-center gap-2 rounded border px-3 py-1.5 text-sm font-medium ${P(t)}`)),r})()}),i})(),(()=>{var i=$e(),c=i.firstChild,m=c.firstChild,x=c.nextSibling,p=x.firstChild,g=p.firstChild,C=g.nextSibling,b=p.nextSibling,v=b.firstChild,a=v.nextSibling;return e(c,s(oe,{size:18}),m),e(C,()=>f()?.use_sql_server?"SQL Server (Híbrido)":"Apenas Parquet (Cloud)"),e(x,s(h,{get when(){return f()?.use_sql_server},get children(){return[(()=>{var t=pe(),n=t.firstChild,r=n.nextSibling;return e(r,()=>f()?.database_server||"N/A"),t})(),(()=>{var t=he(),n=t.firstChild,r=n.nextSibling;return e(r,()=>f()?.database_name||"N/A"),t})(),(()=>{var t=ve(),n=t.firstChild,r=n.nextSibling;return e(r,()=>f()?.database_user||"N/A"),t})()]}}),b),e(x,s(h,{get when(){return f()?.use_supabase},get children(){var t=_e(),n=t.firstChild,r=n.nextSibling;return e(r,()=>f()?.supabase_url||"N/A"),t}}),b),e(a,()=>d()?.parquet.path||"N/A"),y(()=>ae(a,"title",d()?.parquet.path)),i})(),s(h,{get when(){return f()?.use_sql_server},get children(){var i=we(),c=i.firstChild,m=c.firstChild,x=m.firstChild,p=m.nextSibling;return e(m,s(X,{size:18}),x),p.$$click=ee,e(p,(()=>{var g=A(()=>!!F());return()=>g()?[s(H,{size:16,class:"animate-spin"}),"Testando..."]:[s(X,{size:16}),"Testar Conexão"]})()),e(i,s(h,{get when(){return u()},get children(){var g=Se(),C=g.firstChild,b=C.firstChild,v=b.firstChild;return e(C,(()=>{var a=A(()=>!!u()?.success);return()=>a()?s(W,{size:24,class:"text-green-500 flex-shrink-0"}):s(R,{size:24,class:"text-red-500 flex-shrink-0"})})(),b),e(v,()=>u()?.message),e(b,s(h,{get when(){return u()?.version},get children(){var a=ye(),t=a.firstChild,n=t.nextSibling;return e(n,()=>u()?.version),a}}),null),e(b,s(h,{get when(){return A(()=>!!u()?.tables)()&&u().tables.length>0},get children(){var a=Ce(),t=a.firstChild,n=t.firstChild,r=n.nextSibling;r.nextSibling;var j=t.nextSibling,q=j.firstChild;return e(t,s(le,{size:14}),n),e(t,()=>u().tables.length,r),e(q,s(ne,{get each(){return u()?.tables},children:I=>(()=>{var J=De();return e(J,I),J})()})),a}}),null),y(a=>{var t=`p-4 rounded-lg border ${u()?.success?"bg-green-500/10 border-green-500/30":"bg-red-500/10 border-red-500/30"}`,n=`font-medium ${u()?.success?"text-green-500":"text-red-500"}`;return t!==a.e&&w(g,a.e=t),n!==a.t&&w(v,a.t=n),a},{e:void 0,t:void 0}),g}}),null),y(()=>p.disabled=F()),i}}),s(h,{get when(){return!f()?.use_sql_server},get children(){return ke()}})]}}),null),y(()=>z.disabled=E()),l})()}ie(["click"]);export{Le as default};
