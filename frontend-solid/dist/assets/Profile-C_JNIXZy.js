import{a as k,b as ae,t as d,i as r,c as s,F as le,S as E,d as m,k as Se,e as f,j as y,g as ne,h as I,N as ye,f as b,C as N,O as ke,s as ze}from"./index-BTwf99OE.js";import{A as S}from"./alert-circle-vl5fvNJb.js";var Pe=d("<div class=space-y-4>"),Ae=d("<span>"),Ne=d('<div class="flex items-center gap-4 pt-4"><button class="btn btn-primary">'),Ee=d('<div class=space-y-6><div><h3 class="text-lg font-semibold mb-2">Preferências do Usuário</h3><p class="text-sm text-muted-foreground">Configure suas preferências para personalizar sua experiência no Chat BI.'),Te=d("<div>Carregando..."),Fe=d('<select class="input w-full"><option value>Selecione...'),qe=d('<div class=space-y-2><label class="block text-sm font-medium">'),Me=d('<input type=text class="input w-full">'),je=d("<option>");function De(){const[T,F]=k(!1),[u,$]=k(""),[v,q]=k({}),[_]=ae(async()=>(await(await fetch("/api/v1/preferences/common/keys")).json()).keys),[z,{refetch:o}]=ae(async()=>{const c=y.token();if(!c)return{preferences:{}};const t=await(await fetch("/api/v1/preferences",{headers:{Authorization:`Bearer ${c}`}})).json();return q(t.preferences||{}),t}),P=async()=>{const c=y.token();if(c){F(!0),$("");try{if(!(await fetch("/api/v1/preferences/batch",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify(v())})).ok)throw new Error("Falha ao salvar preferências");$("✓ Preferências salvas com sucesso!"),setTimeout(()=>$(""),3e3),o()}catch(e){console.error("Error saving preferences:",e),$("✗ Erro ao salvar preferências")}finally{F(!1)}}},M=(c,e)=>{q(t=>({...t,[c]:e}))};return(()=>{var c=Ee();return c.firstChild,r(c,s(E,{get when(){return!_.loading},get fallback(){return Te()},get children(){return[(()=>{var e=Pe();return r(e,s(le,{get each(){return _()},children:t=>(()=>{var l=qe(),C=l.firstChild;return r(C,()=>t.description),r(l,s(E,{get when(){return t.options},get fallback(){return(()=>{var i=Me();return i.$$input=h=>M(t.key,h.currentTarget.value),m(()=>Se(i,"placeholder",`Digite ${t.description.toLowerCase()}`)),m(()=>i.value=v()[t.key]||""),i})()},get children(){var i=Fe();return i.firstChild,i.addEventListener("change",h=>M(t.key,h.currentTarget.value)),r(i,s(le,{get each(){return t.options},children:h=>(()=>{var j=je();return j.value=h,r(j,h),j})()}),null),m(()=>i.value=v()[t.key]||t.default||""),i}}),null),l})()})),e})(),(()=>{var e=Ne(),t=e.firstChild;return t.$$click=P,r(t,()=>T()?"Salvando...":"Salvar Preferências"),r(e,s(E,{get when(){return u()},get children(){var l=Ae();return r(l,u),m(()=>f(l,`text-sm ${u().startsWith("✓")?"text-green-500":"text-red-500"}`)),l}}),null),m(()=>t.disabled=T()),e})()]}}),null),c})()}ne(["click","input"]);var Le=d('<div class=mt-2><div class="flex justify-between items-center mb-1"><span class="text-xs text-muted-foreground">Força da senha:</span><span></span></div><div class="w-full bg-gray-700 rounded-full h-2"><div>'),Ue=d('<div class="mt-3 space-y-1"><p class="text-xs text-muted-foreground font-medium mb-2">Requisitos:</p><div>Mínimo de 8 caracteres</div><div>Letra maiúscula (A-Z)</div><div>Letra minúscula (a-z)</div><div>Número (0-9)</div><div>Caractere especial (!@#$%^&*...)'),Be=d('<p class="text-xs text-red-500 mt-1 flex items-center gap-1">As senhas não coincidem'),Re=d('<div class="p-6 max-w-3xl mx-auto"><h2 class="text-2xl font-bold mb-6 flex items-center gap-2"> Perfil e Segurança</h2><div class="card border p-6 space-y-6"><div><h3 class="text-lg font-medium">Dados do Usuário</h3><div class="mt-4 grid grid-cols-2 gap-4"><div><label class="text-xs text-muted">Nome de Usuário</label><div class=font-medium></div></div><div><label class="text-xs text-muted">Função (Role)</label><div class="font-medium capitalize"></div></div><div class=col-span-2><label class="text-xs text-muted">Segmentos Permitidos</label><div class="font-mono text-xs bg-secondary p-2 rounded mt-1"></div></div></div></div><hr class=border-border><form class=space-y-4><h3 class="text-lg font-medium">Alterar Senha</h3><div><label class=label>Senha Atual</label><input type=password class=input required></div><div><label class=label>Nova Senha</label><input type=password class=input required></div><div><label class=label>Confirmar Nova Senha</label><input type=password class=input required></div><button type=submit class="btn btn-primary">Salvar Nova Senha</button></form><div class="p-4 bg-blue-500/5 border border-blue-500/20 rounded-lg"><h4 class="font-semibold text-blue-500 mb-2 flex items-center gap-2">Dicas de Segurança</h4><ul class="text-sm text-muted-foreground space-y-1 list-disc list-inside"><li>Nunca compartilhe sua senha com outras pessoas</li><li>Use senhas diferentes para cada sistema</li><li>Evite senhas óbvias como datas de nascimento</li><li>Considere usar um gerenciador de senhas</li><li>Troque sua senha regularmente (a cada 3-6 meses)</li></ul></div></div><div class="card border p-6 mt-6">'),Oe=d("<div>");function Ze(){const[T,F]=k(""),[u,$]=k(""),[v,q]=k(""),[_,z]=k(null),o=I(()=>{const e=u();return{length:e.length>=8,uppercase:/[A-Z]/.test(e),lowercase:/[a-z]/.test(e),number:/\d/.test(e),special:/[!@#$%^&*(),.?":{}|<>]/.test(e)}}),P=I(()=>{const e=o();if(!u())return{score:0,label:"Nenhuma",color:"text-gray-500",barColor:"bg-gray-500"};const l=[e.length,e.uppercase,e.lowercase,e.number,e.special].filter(Boolean).length;return l===5?{score:4,label:"Muito Forte",color:"text-green-500",barColor:"bg-green-500"}:l===4?{score:3,label:"Forte",color:"text-blue-500",barColor:"bg-blue-500"}:l===3?{score:2,label:"Média",color:"text-yellow-500",barColor:"bg-yellow-500"}:l>=1?{score:1,label:"Fraca",color:"text-orange-500",barColor:"bg-orange-500"}:{score:0,label:"Muito Fraca",color:"text-red-500",barColor:"bg-red-500"}}),M=I(()=>{const e=o();return e.length&&e.uppercase&&e.lowercase&&e.number&&e.special}),c=async e=>{if(e.preventDefault(),u()!==v()){z({type:"error",text:"As senhas não coincidem."});return}if(!M()){z({type:"error",text:"A senha não atende aos requisitos mínimos de segurança."});return}try{const t=y.token();if(!t){z({type:"error",text:"Você precisa estar logado."});return}const l=new FormData;l.append("old_password",T()),l.append("new_password",u());const C=await fetch("/api/v1/auth/change-password",{method:"POST",headers:{Authorization:`Bearer ${t}`},body:l});if(!C.ok){const i=await C.json();throw new Error(i.detail||"Erro ao alterar senha")}z({type:"success",text:"Senha alterada com sucesso! Você será deslogado em 3 segundos..."}),F(""),$(""),q(""),setTimeout(()=>{y.logout(),window.location.href="/login"},3e3)}catch(t){z({type:"error",text:t.message||"Erro ao alterar senha"})}};return(()=>{var e=Re(),t=e.firstChild,l=t.firstChild,C=t.nextSibling,i=C.firstChild,h=i.firstChild,j=h.nextSibling,W=j.firstChild,ie=W.firstChild,oe=ie.nextSibling,G=W.nextSibling,ce=G.firstChild,de=ce.nextSibling,ue=G.nextSibling,ge=ue.firstChild,me=ge.nextSibling,pe=i.nextSibling,D=pe.nextSibling,ve=D.firstChild,O=ve.nextSibling,fe=O.firstChild,H=fe.nextSibling,L=O.nextSibling,he=L.firstChild,Q=he.nextSibling,V=L.nextSibling,xe=V.firstChild,X=xe.nextSibling,be=V.nextSibling,$e=D.nextSibling,Y=$e.firstChild,_e=Y.firstChild,Ce=C.nextSibling;return r(t,s(ye,{}),l),r(oe,()=>y.user()?.username),r(de,()=>y.user()?.role),r(me,()=>JSON.stringify(y.user()?.allowed_segments||[],null,2)),D.addEventListener("submit",c),r(D,(()=>{var n=b(()=>!!_());return()=>n()&&(()=>{var p=Oe();return r(p,(()=>{var x=b(()=>_()?.type==="success");return()=>x()?s(N,{size:16}):s(S,{size:16})})(),null),r(p,()=>_()?.text,null),m(()=>f(p,`p-3 rounded text-sm flex items-center gap-2 ${_()?.type==="success"?"bg-green-500/10 text-green-400":"bg-red-500/10 text-red-400"}`)),p})()})(),O),H.$$input=n=>F(n.currentTarget.value),Q.$$input=n=>$(n.currentTarget.value),r(L,s(E,{get when(){return u()},get children(){var n=Le(),p=n.firstChild,x=p.firstChild,U=x.nextSibling,A=p.nextSibling,B=A.firstChild;return r(U,()=>P().label),m(g=>{var R=`text-xs font-medium ${P().color}`,w=`h-2 rounded-full transition-all ${P().barColor}`,J=`width: ${P().score/4*100}%`;return R!==g.e&&f(U,g.e=R),w!==g.t&&f(B,g.t=w),g.a=ze(B,J,g.a),g},{e:void 0,t:void 0,a:void 0}),n}}),null),r(L,s(E,{get when(){return u()},get children(){var n=Ue(),p=n.firstChild,x=p.nextSibling,U=x.firstChild,A=x.nextSibling,B=A.firstChild,g=A.nextSibling,R=g.firstChild,w=g.nextSibling,J=w.firstChild,Z=w.nextSibling,we=Z.firstChild;return r(x,(()=>{var a=b(()=>!!o().length);return()=>a()?s(N,{size:14}):s(S,{size:14})})(),U),r(A,(()=>{var a=b(()=>!!o().uppercase);return()=>a()?s(N,{size:14}):s(S,{size:14})})(),B),r(g,(()=>{var a=b(()=>!!o().lowercase);return()=>a()?s(N,{size:14}):s(S,{size:14})})(),R),r(w,(()=>{var a=b(()=>!!o().number);return()=>a()?s(N,{size:14}):s(S,{size:14})})(),J),r(Z,(()=>{var a=b(()=>!!o().special);return()=>a()?s(N,{size:14}):s(S,{size:14})})(),we),m(a=>{var K=`text-xs flex items-center gap-2 ${o().length?"text-green-500":"text-muted-foreground"}`,ee=`text-xs flex items-center gap-2 ${o().uppercase?"text-green-500":"text-muted-foreground"}`,te=`text-xs flex items-center gap-2 ${o().lowercase?"text-green-500":"text-muted-foreground"}`,re=`text-xs flex items-center gap-2 ${o().number?"text-green-500":"text-muted-foreground"}`,se=`text-xs flex items-center gap-2 ${o().special?"text-green-500":"text-muted-foreground"}`;return K!==a.e&&f(x,a.e=K),ee!==a.t&&f(A,a.t=ee),te!==a.a&&f(g,a.a=te),re!==a.o&&f(w,a.o=re),se!==a.i&&f(Z,a.i=se),a},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),n}}),null),X.$$input=n=>q(n.currentTarget.value),r(V,s(E,{get when(){return b(()=>!!v())()&&u()!==v()},get children(){var n=Be(),p=n.firstChild;return r(n,s(S,{size:12}),p),n}}),null),r(Y,s(ke,{size:18}),_e),r(Ce,s(De,{})),m(()=>be.disabled=!M()||u()!==v()),m(()=>H.value=T()),m(()=>Q.value=u()),m(()=>X.value=v()),e})()}ne(["input"]);export{Ze as default};
