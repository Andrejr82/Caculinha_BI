import{c as l,m as je,I as Ge,t as b,i as e,f as we,P as Gt,d as le,e as ue,z as Vt,g as ut,a as k,o as Qt,A as ke,D as qt,S as re,X as Oe,F as ve,R as Xt,E as Kt,U as Re,k as te,s as Fe}from"./index-BTwf99OE.js";import{P as Me}from"./PlotlyChart-DkK15PvE.js";import{C as Be}from"./ChartDownloadButton-C4C04u9H.js";import{U as Ht}from"./users-BU7OZROo.js";import{A as Jt}from"./alert-circle-vl5fvNJb.js";import{S as Wt}from"./search-BFmEHNBW.js";import{P as Le}from"./package-DVlwFfH0.js";import{F as Yt}from"./filter-CmxAUFBN.js";import{S as ze}from"./shopping-cart-JDnD2WCW.js";import{R as Zt}from"./refresh-cw-BvDo3NQr.js";import{T as at}from"./trending-up-Bq2ldSGv.js";import{B as el}from"./bar-chart-3-XZbit7Hz.js";const tl=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],nt=g=>l(Ge,je(g,{name:"Archive",iconNode:tl})),ll=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],il=g=>l(Ge,je(g,{name:"Inbox",iconNode:ll})),rl=[["path",{d:"M21 10V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l2-1.14",key:"e7tb2h"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["line",{x1:"12",x2:"12",y1:"22",y2:"12",key:"a4e8g8"}],["path",{d:"m17 13 5 5m-5 0 5-5",key:"im3w4b"}]],ot=g=>l(Ge,je(g,{name:"PackageX",iconNode:rl}));var sl=b('<div class="flex flex-col items-center justify-center p-12 text-center"><div></div><h3 class="text-lg font-semibold text-foreground mb-2">'),al=b('<p class="text-sm text-muted-foreground max-w-md mb-6">'),nl=b('<button class="btn btn-primary">');function ol(g){const De=g.variant||"default",se=()=>{if(g.customIcon)return g.customIcon;const F={size:64,class:"opacity-20"};switch(g.icon){case"package":return l(Le,F);case"search":return l(Wt,F);case"alert":return l(Jt,F);case"file":return l(Vt,F);case"users":return l(Ht,F);case"inbox":default:return l(il,F)}},Ie=()=>{switch(De){case"success":return"text-green-500";case"warning":return"text-yellow-500";case"info":return"text-blue-500";default:return"text-muted-foreground"}};return(()=>{var F=sl(),pe=F.firstChild,ge=pe.nextSibling;return e(pe,se),e(ge,()=>g.title),e(F,(()=>{var he=we(()=>!!g.description);return()=>he()&&(()=>{var m=al();return e(m,()=>g.description),m})()})(),null),e(F,(()=>{var he=we(()=>!!g.action);return()=>he()&&(()=>{var m=nl();return Gt(m,"click",g.action.onClick,!0),e(m,()=>g.action.label),m})()})(),null),le(()=>ue(pe,`mb-4 ${Ie()}`)),F})()}function dl(g){return l(ol,{icon:"package",variant:"success",get title(){return g.title},get description(){return g.description}})}ut(["click"]);var cl=b("<option value>Todos"),ul=b("<option value>Todas"),gl=b('<div class="p-4 bg-card border rounded-lg"role=region aria-label="Filtros de rupturas"><div class="flex items-center justify-between mb-4"><h3 class=font-semibold>Filtros</h3><button class="text-muted-foreground hover:text-foreground"aria-label="Fechar filtros"></button></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4"><div><label for=segmento-filter class="block text-sm font-medium mb-2">Segmento</label><select id=segmento-filter class="w-full px-3 py-2 bg-background border rounded-lg disabled:opacity-50 min-h-[44px]"aria-label="Filtrar por segmento"></select></div><div><label for=une-filter class="block text-sm font-medium mb-2">UNE</label><select id=une-filter class="w-full px-3 py-2 bg-background border rounded-lg disabled:opacity-50 min-h-[44px]"aria-label="Filtrar por UNE (loja)"></select></div><div class="flex items-end gap-2"><button class="btn btn-primary flex-1"aria-label="Aplicar filtros selecionados">Aplicar Filtros</button><button class="btn btn-outline"aria-label="Limpar todos os filtros">'),bl=b('<div class=space-y-6><div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><div class="card p-6 border"role=region aria-label="Gr√°fico de top grupos em ruptura"><div class="flex justify-between items-center mb-4"><h3 class="font-semibold flex items-center gap-2">Top Grupos em Ruptura</h3></div><p class="text-xs text-muted mt-2">üí° Clique nas barras para ver produtos do grupo</p></div><div class="card p-6 border"role=region aria-label="Gr√°fico de top 10 produtos em ruptura"><div class="flex justify-between items-center mb-4"><h3 class="font-semibold flex items-center gap-2">Top 10 Produtos em Ruptura</h3></div><p class="text-xs text-muted mt-2">üí° Clique nas barras para ver detalhes do produto</p></div></div><div class="card p-6 border"role=region aria-label="Gr√°fico de necessidade por segmento"><div class="flex justify-between items-center mb-4"><h3 class="font-semibold flex items-center gap-2">Necessidade por Segmento'),xl=b('<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"><div class="bg-card border rounded-lg p-6 max-w-2xl w-full"role=dialog aria-modal=true aria-labelledby=product-modal-title><div class="flex justify-between items-start mb-4"><h3 id=product-modal-title class="text-xl font-bold">Detalhes da Ruptura</h3><button class="text-muted hover:text-foreground"aria-label="Fechar detalhes do produto"></button></div><div class=space-y-4><div><p class="text-sm text-muted">Produto</p><p class="font-mono font-medium"></p></div><div><p class="text-sm text-muted">Nome</p><p class=font-medium></p></div><div class="grid grid-cols-2 gap-4"><div><p class="text-sm text-muted">UNE / Loja</p><p class=font-medium> - </p></div><div><p class="text-sm text-muted">Segmento</p><p class=font-medium></p></div></div><div class="grid grid-cols-3 gap-4"><div class="p-3 bg-green-500/10 border border-green-500/30 rounded"><p class="text-xs text-muted">Vendas (30d)</p><p class="text-xl font-bold text-green-500"></p></div><div class="p-3 bg-red-500/10 border border-red-500/30 rounded"><p class="text-xs text-muted">Estoque Loja</p><p class="text-xl font-bold text-red-500"></p></div><div class="p-3 bg-blue-500/10 border border-blue-500/30 rounded"><p class="text-xs text-muted">Linha Verde</p><p class="text-xl font-bold text-blue-500"></p></div></div><div class="p-4 bg-orange-500/10 border border-orange-500/30 rounded"><p class="text-sm text-muted mb-2">Necessidade de Reposi√ß√£o</p><p class="text-3xl font-bold text-orange-500"> unidades</p><div class=mt-3><div class="flex justify-between text-sm mb-1"><span>Criticidade</span><span class=font-medium>%</span></div><div class="w-full bg-gray-700 rounded-full h-2"><div></div></div></div></div></div><div class="mt-6 flex justify-end"><button class="btn btn-primary"aria-label="Fechar modal de detalhes">Fechar'),fl=b('<div class="text-center py-8 text-muted"><p>Nenhum produto encontrado para este grupo'),pl=b('<div class="fixed inset-0 bg-black/60 flex items-center justify-center z-[9998] p-0 md:p-4"><div class="bg-background rounded-none md:rounded-xl shadow-xl max-w-4xl w-full h-full md:h-auto md:max-h-[85vh] overflow-hidden animate-in fade-in zoom-in-95 duration-200"role=dialog aria-modal=true aria-labelledby=group-modal-title aria-describedby=group-modal-description><div class="p-4 border-b bg-gradient-to-r from-red-500/10 to-orange-500/10"><div class="flex justify-between items-center"><div><h3 id=group-modal-title class="text-xl font-bold flex items-center gap-2">Produtos em Ruptura: </h3><p id=group-modal-description class="text-sm text-muted mt-1"> produtos | <!> cr√≠ticos</p></div><button class="p-2 hover:bg-muted rounded-full"aria-label="Fechar modal de produtos do grupo"></button></div></div><div class="overflow-auto max-h-[60vh] p-4"><table class="w-full text-sm hidden md:table"role=table><thead class="sticky top-0 bg-background"><tr class=border-b><th class="text-left p-2 font-semibold">C√≥digo</th><th class="text-left p-2 font-semibold">Produto</th><th class="text-left p-2 font-semibold">UNE / Loja</th><th class="text-right p-2 font-semibold">Criticidade</th><th class="text-right p-2 font-semibold">Necessidade</th><th class="text-right p-2 font-semibold">Venda 30d</th><th class="text-right p-2 font-semibold">Estoque</th></tr></thead><tbody></tbody></table><div class="md:hidden space-y-3"></div></div><div class="p-4 border-t flex justify-between items-center bg-muted/30"><div class="text-sm text-muted">Necessidade total: <strong class=text-red-500> un</strong></div><button class="btn btn-primary"aria-label="Fechar modal">Fechar'),hl=b('<div class="border rounded-lg overflow-hidden bg-card shadow-sm hidden md:block"role=region aria-label="Tabela de rupturas cr√≠ticas"><div class=overflow-x-auto><table class="w-full text-sm text-left"role=table aria-label="Lista completa de rupturas cr√≠ticas"><thead class="bg-muted/50 text-xs uppercase font-medium text-muted-foreground border-b"><tr><th class="px-4 py-3">Produto</th><th class="px-4 py-3">UNE</th><th class="px-4 py-3 text-right">Venda (30d)</th><th class="px-4 py-3 text-right">Est. Loja</th><th class="px-4 py-3 text-right">Est. CD</th><th class="px-4 py-3 text-right">Linha Verde</th><th class="px-4 py-3 text-right">Necessidade</th><th class="px-4 py-3 text-center">Criticidade</th></tr></thead><tbody class=divide-y>'),ml=b('<div class="md:hidden space-y-3">'),Cl=b('<div class="flex flex-col p-6 gap-6 max-w-7xl mx-auto"><div class="flex justify-between items-start"><div><h2 class="text-2xl font-bold tracking-tight text-red-500 flex items-center gap-2">Rupturas Cr√≠ticas</h2><p class="text-muted mt-1">CD zerado + Estoque loja abaixo da Linha Verde</p></div><div class="flex gap-2"><button class="btn btn-outline gap-2">Filtros</button><button class="btn gap-2"title="Gerar arquivo para pedido de compra agrupado por categoria"aria-label="Gerar pedido de compra agrupado por categoria"style=background-color:#2D7A3E;color:white>Gerar Pedido de Compra</button><button class="btn btn-outline gap-2"aria-label="Exportar dados em CSV">CSV</button><button class="btn btn-outline gap-2">Atualizar</button></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-4"role=region aria-label="Resumo de m√©tricas de rupturas"><div class="p-4 bg-card border rounded-lg"role=article aria-label="Total de rupturas cr√≠ticas"><div class="flex items-center gap-3"><div class="p-2 bg-red-500/10 rounded-lg"></div><div><p class="text-sm text-muted-foreground">Total de Rupturas</p><p class="text-2xl font-bold"></p></div></div></div><div class="p-4 bg-card border rounded-lg"role=article aria-label="Produtos com criticidade alta"><div class="flex items-center gap-3"><div class="p-2 bg-orange-500/10 rounded-lg"></div><div><p class="text-sm text-muted-foreground">Criticidade Alta (‚â•75%)</p><p class="text-2xl font-bold"></p></div></div></div><div class="p-4 bg-card border rounded-lg"role=article aria-label="Taxa de criticidade"><div class="flex items-center gap-3"><div class="p-2 bg-blue-500/10 rounded-lg"></div><div><p class="text-sm text-muted-foreground">Taxa Cr√≠tica</p><p class="text-2xl font-bold">%</p></div></div></div></div><div class="p-4 bg-blue-500/5 border border-blue-500/20 rounded-lg"><h3 class="font-semibold text-blue-500 mb-2">O que √© Ruptura Cr√≠tica?</h3><p class="text-sm text-muted-foreground">Produtos com <strong>estoque no CD zerado (ESTOQUE_CD = 0)</strong> e <strong>estoque da loja abaixo da Linha Verde (ESTOQUE_UNE &lt; ESTOQUE_LV)</strong> que tiveram vendas nos √∫ltimos 30 dias. A criticidade √© calculada pela raz√£o entre vendas e linha verde.'),dt=b("<option>Carregando filtros..."),_l=b("<option disabled>Nenhum segmento dispon√≠vel"),ct=b("<option>"),vl=b("<option disabled>Nenhuma UNE dispon√≠vel"),$l=b('<tr class="border-b hover:bg-muted/50 transition-colors"><td class="p-2 font-mono text-xs"></td><td class="p-2 max-w-[200px] truncate"></td><td class=p-2><div class="flex flex-col"><span class="text-xs font-mono"></span><span class="text-[10px] text-muted-foreground truncate max-w-[100px]"></span></div></td><td class="p-2 text-right"><span>%</span></td><td class="p-2 text-right font-semibold text-red-500"> un</td><td class="p-2 text-right"></td><td class="p-2 text-right text-muted"> / '),El=b('<div class="bg-card border rounded-lg p-3 space-y-2"><div class="flex justify-between items-start"><div class=flex-1><p class="font-medium text-sm leading-tight"></p><p class="text-xs font-mono text-muted-foreground mt-1">SKU: </p></div><span>%</span></div><div class="grid grid-cols-2 gap-2 text-xs pt-2 border-t"><div><span class=text-muted-foreground>UNE:</span><span class="ml-1 font-mono"></span></div><div class=truncate><span class=text-muted-foreground>Loja:</span><span class="ml-1 text-xs"></span></div></div><div class="grid grid-cols-2 gap-2 text-xs"><div><span class=text-muted-foreground>Necessidade:</span><span class="ml-1 font-semibold text-red-500"> un</span></div><div><span class=text-muted-foreground>Venda 30d:</span><span class=ml-1></span></div></div><div class="text-xs pt-2 border-t"><span class=text-muted-foreground>Estoque UNE / LV:</span><span class=ml-1> / '),Sl=b('<div class="p-12 text-center border rounded-xl bg-card text-muted animate-pulse">Identificando rupturas cr√≠ticas...'),Dl=b('<div class="p-6 bg-red-900/10 border border-red-900/30 rounded-lg text-red-300 flex items-center gap-3"><div><h3 class=font-bold>Erro ao carregar dados</h3><p class="text-sm opacity-80">'),Il=b('<div class="border border-dashed rounded-xl">'),yl=b('<tr class="hover:bg-muted/30 transition-colors"><td class="px-4 py-3"><div class=font-medium></div><div class="text-xs text-muted-foreground font-mono"></div></td><td class="px-4 py-3"><div class="flex flex-col"><span class="px-2 py-1 bg-secondary rounded text-xs font-mono w-fit"></span><span class="text-[10px] text-muted-foreground mt-1 truncate max-w-[120px]"></span></div></td><td class="px-4 py-3 text-right font-medium"><div class="flex items-center justify-end gap-1 text-green-500"></div></td><td class="px-4 py-3 text-right font-medium text-red-500"><div class="flex items-center justify-end gap-1"></div></td><td class="px-4 py-3 text-right font-medium text-red-500"></td><td class="px-4 py-3 text-right font-medium text-blue-500"></td><td class="px-4 py-3 text-right font-bold text-orange-500"> un</td><td class="px-4 py-3 text-center"><div class="flex flex-col items-center gap-1"><span></span><div class="w-full bg-gray-700 rounded-full h-1.5 mt-1"><div></div></div><span class="text-xs text-muted-foreground">%'),Tl=b('<div class="bg-card border-2 rounded-lg p-4 space-y-3 border-red-500/30"><div class="flex justify-between items-start gap-2"><div class=flex-1><p class="font-semibold text-sm leading-tight"></p><p class="text-xs font-mono text-muted-foreground mt-1">SKU: </p></div><span></span></div><div class="flex items-center gap-2"><span class="px-2 py-1 bg-secondary rounded text-xs font-mono"></span><span class="text-xs text-muted-foreground truncate"></span></div><div class="pt-2 border-t"><div class="flex justify-between items-center mb-1"><span class="text-xs text-muted-foreground">Criticidade</span><span class="text-xs font-semibold">%</span></div><div class="w-full bg-gray-300 dark:bg-gray-700 rounded-full h-2"><div></div></div></div><div class="grid grid-cols-2 gap-3 pt-2 border-t text-xs"><div class=space-y-1><div class="flex items-center gap-1 text-green-500"><span class=text-muted-foreground>Venda 30d</span></div><p class=font-semibold> un</p></div><div class=space-y-1><div class="flex items-center gap-1 text-red-500"><span class=text-muted-foreground>Est. Loja</span></div><p class="font-semibold text-red-500"> un</p></div><div class=space-y-1><span class=text-muted-foreground>Est. CD</span><p class="font-semibold text-red-500"> un</p></div><div class=space-y-1><span class=text-muted-foreground>Linha Verde</span><p class="font-semibold text-blue-500"> un</p></div></div><div class="pt-2 border-t bg-orange-500/10 -mx-4 -mb-4 px-4 py-3 rounded-b-lg"><div class="flex justify-between items-center"><span class="text-xs font-medium text-muted-foreground">Necessidade de Transfer√™ncia</span><span class="text-lg font-bold text-orange-500"> un');function Ll(){const[g,De]=k([]),[se,Ie]=k(!0),[F,pe]=k(""),[ge,he]=k({total:0,criticos:0,valor_estimado:0}),m=i=>i?.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})||"0,00",[gt,bt]=k({}),[xt,ft]=k({}),[pt,ht]=k({}),[A,ye]=k(null),[Te,Ne]=k(null),[mt,Ve]=k([]),[Ct,Qe]=k([]),[qe,Xe]=k(""),[Ke,He]=k(""),[$e,Je]=k(!1),[me,We]=k(!1),_t=async()=>{We(!0);try{const[i,d]=await Promise.all([Re.getSegmentos(),Re.getUnes()]);Ve(Array.isArray(i.data)?i.data:[]),Qe(Array.isArray(d.data)?d.data:[])}catch(i){console.error("Error loading filters:",i),Ve([]),Qe([])}finally{We(!1)}},Ae=async()=>{Ie(!0),pe(null);try{const i=qe()||void 0,d=Ke()||void 0;console.log("üîç [Rupturas] Carregando dados com filtros:",{segmento:i,une:d});const[c,$]=await Promise.all([Re.getCritical(50,i,d),Re.getSummary(i,d)]);console.log("üìä [Rupturas] Dados recebidos:",c.data.length,"produtos"),console.log("üìä [Rupturas] UNEs nos dados:",[...new Set(c.data.map(x=>x.UNE))]),De(c.data),he($.data),vt(c.data)}catch(i){console.error("Error loading rupturas:",i),pe(i.response?.data?.detail||"Falha ao carregar rupturas cr√≠ticas."),De([]),he({total:0,criticos:0,valor_estimado:0})}finally{Ie(!1)}},vt=i=>{if(i.length===0)return;const d={};i.forEach(t=>{const r=t.NOMEGRUPO||t.NOMESEGMENTO||"SEM GRUPO";d[r]||(d[r]={total:0,criticos:0,necessidade:0}),d[r].total++,d[r].necessidade+=t.NECESSIDADE,t.CRITICIDADE_PCT>=75&&d[r].criticos++});const c=Object.entries(d).sort((t,r)=>r[1].criticos-t[1].criticos).slice(0,8);bt({data:[{type:"bar",orientation:"h",y:c.map(([t])=>t.length>25?t.substring(0,25)+"...":t),x:c.map(([,t])=>t.criticos),marker:{color:c.map(([,t])=>{const r=t.criticos/t.total;return r>=.8?"#B94343":r>=.5?"#CC8B3C":"#C9A961"}),line:{color:"#E5E5E5",width:1}},text:c.map(([,t])=>`${t.criticos} cr√≠ticos (${Math.round(t.necessidade)} un)`),textposition:"auto",textfont:{color:"#FFFFFF",size:11,family:"Inter, sans-serif"},hovertemplate:"<b>%{y}</b><br>Produtos cr√≠ticos: %{x}<br>Total no grupo: %{customdata[0]}<br>Necessidade: %{customdata[1]:.0f} un<extra></extra>",customdata:c.map(([,t])=>[t.total,t.necessidade])}],layout:{title:{text:'<b>üî¥ Top Grupos em Ruptura Cr√≠tica</b><br><span style="font-size:11px;color:#6B6B6B">Categorias com mais produtos em situa√ß√£o cr√≠tica (‚â•75%)</span>',font:{size:14,color:"#2D2D2D",family:"Inter, sans-serif"},x:.02},xaxis:{title:"Produtos Cr√≠ticos",titlefont:{color:"#6B6B6B",size:11,family:"Inter, sans-serif"},tickfont:{color:"#6B6B6B",family:"Inter, sans-serif"},gridcolor:"#E5E5E5",zeroline:!1},yaxis:{tickfont:{color:"#2D2D2D",size:10,family:"Inter, sans-serif"},automargin:!0},plot_bgcolor:"#FFFFFF",paper_bgcolor:"#FAFAFA",margin:{l:150,r:20,t:70,b:50},font:{color:"#2D2D2D",family:"Inter, sans-serif"},showlegend:!1,bargap:.25},config:{responsive:!0,displayModeBar:!1}});const $=i.sort((t,r)=>r.NECESSIDADE-t.NECESSIDADE).slice(0,10);ft({data:[{type:"bar",x:$.map(t=>t.NOME.substring(0,30)+"..."),y:$.map(t=>t.NECESSIDADE),marker:{color:$.map(t=>t.CRITICIDADE_PCT>=75?"#B94343":t.CRITICIDADE_PCT>=50?"#CC8B3C":t.CRITICIDADE_PCT>=25?"#C9A961":"#5B7B9A"),line:{color:"#E5E5E5",width:1}},text:$.map(t=>Math.round(t.NECESSIDADE)),textposition:"outside",textfont:{color:"#2D2D2D",family:"Inter, sans-serif"},hovertemplate:"<b>%{x}</b><br>Loja: %{customdata[1]}<br>Necessidade: %{y:.0f} un<extra></extra>",customdata:$.map(t=>[t.PRODUTO,t.UNE_NOME||"N/A"])}],layout:{title:{text:"Top 10 Produtos - Maior Necessidade",font:{size:16,color:"#2D2D2D",family:"Inter, sans-serif"}},xaxis:{title:"",tickangle:-45,tickfont:{size:9,color:"#6B6B6B",family:"Inter, sans-serif"},gridcolor:"#E5E5E5",linecolor:"#E5E5E5"},yaxis:{title:"Necessidade (unidades)",titlefont:{color:"#6B6B6B",family:"Inter, sans-serif"},tickfont:{color:"#6B6B6B",family:"Inter, sans-serif"},gridcolor:"#E5E5E5",linecolor:"#E5E5E5"},plot_bgcolor:"#FFFFFF",paper_bgcolor:"#FAFAFA",margin:{l:60,r:20,t:60,b:120},font:{color:"#2D2D2D",family:"Inter, sans-serif"}},config:{responsive:!0}});const x={};i.forEach(t=>{const r=t.NOMEGRUPO||t.NOMESEGMENTO||"SEM GRUPO";x[r]||(x[r]={critico:0,alto:0,medio:0,baixo:0,total:0});const D=t.NECESSIDADE;x[r].total+=D,t.CRITICIDADE_PCT>=75?x[r].critico+=D:t.CRITICIDADE_PCT>=50?x[r].alto+=D:t.CRITICIDADE_PCT>=25?x[r].medio+=D:x[r].baixo+=D});const S=Object.keys(x).sort((t,r)=>x[r].total-x[t].total).slice(0,10);ht({data:[{type:"bar",name:"üî¥ CR√çTICO",x:S,y:S.map(t=>x[t].critico),marker:{color:"#B94343"},hovertemplate:"<b>%{x}</b><br>Cr√≠tico: %{y:.0f} un<extra></extra>"},{type:"bar",name:"üü† ALTO",x:S,y:S.map(t=>x[t].alto),marker:{color:"#CC8B3C"},hovertemplate:"<b>%{x}</b><br>Alto: %{y:.0f} un<extra></extra>"},{type:"bar",name:"üü° M√âDIO",x:S,y:S.map(t=>x[t].medio),marker:{color:"#C9A961"},hovertemplate:"<b>%{x}</b><br>M√©dio: %{y:.0f} un<extra></extra>"},{type:"bar",name:"üîµ BAIXO",x:S,y:S.map(t=>x[t].baixo),marker:{color:"#5B7B9A"},hovertemplate:"<b>%{x}</b><br>Baixo: %{y:.0f} un<extra></extra>"}],layout:{title:{text:'<b>Necessidade de Reposi√ß√£o por Grupo de Produtos</b><br><span style="font-size:11px;color:#6B6B6B">Top 10 grupos ordenados por volume de necessidade</span>',font:{size:14,color:"#2D2D2D",family:"Inter, sans-serif"},x:.02},barmode:"stack",xaxis:{title:"",tickangle:-45,tickfont:{size:10,color:"#6B6B6B",family:"Inter, sans-serif"},gridcolor:"#E5E5E5",linecolor:"#E5E5E5"},yaxis:{title:"Necessidade Total (unidades)",titlefont:{color:"#6B6B6B",size:11,family:"Inter, sans-serif"},tickfont:{color:"#6B6B6B",family:"Inter, sans-serif"},gridcolor:"#E5E5E5",linecolor:"#E5E5E5"},plot_bgcolor:"#FFFFFF",paper_bgcolor:"#FAFAFA",margin:{l:70,r:20,t:80,b:120},font:{color:"#2D2D2D",family:"Inter, sans-serif"},showlegend:!0,legend:{orientation:"h",x:.5,y:1.12,xanchor:"center",font:{size:10,color:"#2D2D2D",family:"Inter, sans-serif"},bgcolor:"rgba(255,255,255,0.9)",bordercolor:"#E5E5E5",borderwidth:1}},config:{responsive:!0,displayModeBar:!1}})},$t=i=>{if(i&&i.points&&i.points[0]){const d=i.points[0];if(d.customdata){const c=g().find($=>$.PRODUTO===d.customdata);c&&ye(c)}}},Et=i=>{if(i&&i.points&&i.points[0]){const d=i.points[0],c=d.y||d.label;if(c){const $=c.replace("...","");Ne($)}}},Ce=()=>{const i=Te();return i?g().filter(d=>{const c=d.NOMEGRUPO||d.NOMESEGMENTO||"SEM GRUPO";return c.toLowerCase().includes(i.toLowerCase())||i.toLowerCase().includes(c.substring(0,20).toLowerCase())}).sort((d,c)=>c.CRITICIDADE_PCT-d.CRITICIDADE_PCT):[]},St=()=>{Xe(""),He(""),Ae()},Dt=()=>{const i=g();if(i.length===0)return;const d=["Produto","Nome","UNE","Loja","Segmento","Grupo","Venda 30d","Estoque UNE","Estoque CD","Linha Verde","Criticidade %","Necessidade"],c=i.map(r=>[r.PRODUTO,r.NOME,r.UNE,r.UNE_NOME||"",r.NOMESEGMENTO||"",r.NOMEGRUPO||"",r.VENDA_30DD,r.ESTOQUE_UNE,r.ESTOQUE_CD,r.ESTOQUE_LV,r.CRITICIDADE_PCT.toFixed(1),r.NECESSIDADE]),$=[d,...c].map(r=>r.join(",")).join(`
`),x=new Blob([$],{type:"text/csv"}),S=URL.createObjectURL(x),t=document.createElement("a");t.href=S,t.download=`rupturas_criticas_${new Date().toISOString().split("T")[0]}.csv`,t.click(),URL.revokeObjectURL(S)},It=()=>{const i=g();if(i.length===0)return;const d={};i.forEach(t=>{const r=t.NOMEGRUPO||t.NOMESEGMENTO||"SEM GRUPO";d[r]||(d[r]=[]),d[r].push(t)});let c=`=== PEDIDO DE COMPRA - REPOSI√á√ÉO DE RUPTURAS CR√çTICAS ===
`;c+=`Data de Gera√ß√£o: ${new Date().toLocaleString("pt-BR")}
`,c+=`Total de Produtos: ${i.length}
`,c+=`Total de Grupos: ${Object.keys(d).length}

`,Object.entries(d).sort((t,r)=>r[1].reduce((D,be)=>D+be.NECESSIDADE,0)-t[1].reduce((D,be)=>D+be.NECESSIDADE,0)).forEach(([t,r])=>{const D=r.reduce((N,Ee)=>N+Ee.NECESSIDADE,0),be=r.filter(N=>N.CRITICIDADE_PCT>=75).length;c+=`
--- ${t.toUpperCase()} ---
`,c+=`Produtos: ${r.length} | Cr√≠ticos: ${be} | Necessidade Total: ${Math.round(D)} un
`,c+=`C√≥digo,Nome,Necessidade (un),Criticidade %
`,r.sort((N,Ee)=>Ee.CRITICIDADE_PCT-N.CRITICIDADE_PCT).forEach(N=>{c+=`${N.PRODUTO},"${N.NOME.substring(0,50)}",${Math.round(N.NECESSIDADE)},${N.CRITICIDADE_PCT.toFixed(0)}%
`})});const $=new Blob([c],{type:"text/csv;charset=utf-8"}),x=URL.createObjectURL($),S=document.createElement("a");S.href=x,S.download=`pedido_compra_rupturas_${new Date().toISOString().split("T")[0]}.csv`,S.click(),URL.revokeObjectURL(x)};Qt(()=>{_t(),Ae()});const Ye=i=>i>=75?"bg-red-500/20 text-red-500 border-red-500/30":i>=50?"bg-orange-500/20 text-orange-500 border-orange-500/30":i>=25?"bg-yellow-500/20 text-yellow-500 border-yellow-500/30":"bg-blue-500/20 text-blue-500 border-blue-500/30",Ze=i=>i>=75?"CR√çTICO":i>=50?"ALTO":i>=25?"M√âDIO":"BAIXO";return l(Kt,{get children(){var i=Cl(),d=i.firstChild,c=d.firstChild,$=c.firstChild,x=$.firstChild,S=c.nextSibling,t=S.firstChild,r=t.firstChild,D=t.nextSibling,be=D.firstChild,N=D.nextSibling,Ee=N.firstChild,_e=N.nextSibling,yt=_e.firstChild,Pe=d.nextSibling,et=Pe.firstChild,Tt=et.firstChild,tt=Tt.firstChild,Nt=tt.nextSibling,At=Nt.firstChild,Ot=At.nextSibling,lt=et.nextSibling,Rt=lt.firstChild,it=Rt.firstChild,wt=it.nextSibling,Pt=wt.firstChild,Ut=Pt.nextSibling,kt=lt.nextSibling,Ft=kt.firstChild,rt=Ft.firstChild,Mt=rt.nextSibling,Bt=Mt.firstChild,st=Bt.nextSibling,zt=st.firstChild;return Pe.nextSibling,e($,l(ke,{size:24}),x),t.$$click=()=>{console.log("Toggling filters:",!$e()),Je(!$e())},e(t,l(Yt,{size:16}),r),D.$$click=It,e(D,l(ze,{size:16}),be),N.$$click=Dt,e(N,l(qt,{size:16}),Ee),_e.$$click=Ae,e(_e,l(Zt,{size:16,get class(){return se()?"animate-spin":""}}),yt),e(i,l(re,{get when(){return $e()},get children(){var s=gl(),n=s.firstChild,h=n.firstChild,C=h.nextSibling,E=n.nextSibling,o=E.firstChild,I=o.firstChild,f=I.nextSibling,y=o.nextSibling,O=y.firstChild,T=O.nextSibling,M=y.nextSibling,_=M.firstChild,R=_.nextSibling;return C.$$click=()=>Je(!1),e(C,l(Oe,{size:18})),f.addEventListener("change",u=>Xe(u.target.value)),e(f,l(re,{get when(){return!me()},get fallback(){return dt()},get children(){return[cl(),l(ve,{get each(){return mt()},get fallback(){return _l()},children:u=>(()=>{var p=ct();return p.value=u,e(p,u),p})()})]}})),T.addEventListener("change",u=>He(u.target.value)),e(T,l(re,{get when(){return!me()},get fallback(){return dt()},get children(){return[ul(),l(ve,{get each(){return Ct()},get fallback(){return vl()},children:u=>(()=>{var p=ct();return p.value=u,e(p,u),p})()})]}})),_.$$click=Ae,R.$$click=St,e(R,l(Oe,{size:16})),le(u=>{var p=me(),W=me(),L=me(),G=me(),j=se();return p!==u.e&&(f.disabled=u.e=p),W!==u.t&&te(f,"aria-busy",u.t=W),L!==u.a&&(T.disabled=u.a=L),G!==u.o&&te(T,"aria-busy",u.o=G),j!==u.i&&te(_,"aria-busy",u.i=j),u},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),le(()=>f.value=qe()),le(()=>T.value=Ke()),s}}),Pe),e(tt,l(ot,{size:24,class:"text-red-500"})),e(Ot,()=>ge().total),e(it,l(ke,{size:24,class:"text-orange-500"})),e(Ut,()=>ge().criticos),e(rt,l(at,{size:24,class:"text-blue-500"})),e(st,(()=>{var s=we(()=>ge().total>0);return()=>s()?(ge().criticos/ge().total*100).toFixed(0):0})(),zt),e(i,l(re,{get when(){return we(()=>!se())()&&g().length>0},get children(){var s=bl(),n=s.firstChild,h=n.firstChild,C=h.firstChild,E=C.firstChild,o=E.firstChild,I=C.nextSibling,f=h.nextSibling,y=f.firstChild,O=y.firstChild,T=O.firstChild,M=y.nextSibling,_=n.nextSibling,R=_.firstChild,u=R.firstChild,p=u.firstChild;return e(E,l(Xt,{size:20,class:"text-red-500"}),o),e(C,l(Be,{chartId:"criticidade-chart",filename:"rupturas_criticidade",label:"Baixar"}),null),e(h,l(Me,{chartSpec:gt,chartId:"criticidade-chart",enableDownload:!0,height:"350px",onDataClick:Et}),I),e(O,l(el,{size:20,class:"text-orange-500"}),T),e(y,l(Be,{chartId:"top-rupturas-chart",filename:"rupturas_top10",label:"Baixar"}),null),e(f,l(Me,{chartSpec:xt,chartId:"top-rupturas-chart",enableDownload:!0,height:"350px",onDataClick:$t}),M),e(u,l(at,{size:20,class:"text-green-500"}),p),e(R,l(Be,{chartId:"necessidade-segmento-chart",filename:"rupturas_por_segmento",label:"Baixar"}),null),e(_,l(Me,{chartSpec:pt,chartId:"necessidade-segmento-chart",enableDownload:!0,height:"400px"}),null),s}}),null),e(i,l(re,{get when(){return A()},get children(){var s=xl(),n=s.firstChild,h=n.firstChild,C=h.firstChild,E=C.nextSibling,o=h.nextSibling,I=o.firstChild,f=I.firstChild,y=f.nextSibling,O=I.nextSibling,T=O.firstChild,M=T.nextSibling,_=O.nextSibling,R=_.firstChild,u=R.firstChild,p=u.nextSibling,W=p.firstChild,L=R.nextSibling,G=L.firstChild,j=G.nextSibling,V=_.nextSibling,oe=V.firstChild,a=oe.firstChild,w=a.nextSibling,P=oe.nextSibling,U=P.firstChild,Q=U.nextSibling,q=P.nextSibling,X=q.firstChild,v=X.nextSibling,K=V.nextSibling,B=K.firstChild,H=B.nextSibling,Y=H.firstChild,xe=H.nextSibling,ie=xe.firstChild,ae=ie.firstChild,ne=ae.nextSibling,z=ne.firstChild,de=ie.nextSibling,Z=de.firstChild,ce=o.nextSibling,ee=ce.firstChild;return s.$$click=()=>ye(null),n.$$click=J=>J.stopPropagation(),E.$$click=()=>ye(null),e(E,l(Oe,{size:20})),e(y,()=>A().PRODUTO),e(M,()=>A().NOME),e(p,()=>A().UNE,W),e(p,()=>A().UNE_NOME||"N/A",null),e(j,()=>A().NOMESEGMENTO||"N/A"),e(w,()=>m(A().VENDA_30DD)),e(Q,()=>m(A().ESTOQUE_UNE)),e(v,()=>m(A().ESTOQUE_LV)),e(H,()=>m(A().NECESSIDADE),Y),e(ne,()=>A().CRITICIDADE_PCT.toFixed(0),z),ee.$$click=()=>ye(null),le(J=>{var fe=`h-2 rounded-full ${A().CRITICIDADE_PCT>=75?"bg-red-500":A().CRITICIDADE_PCT>=50?"bg-orange-500":A().CRITICIDADE_PCT>=25?"bg-yellow-500":"bg-blue-500"}`,Se=`width: ${A().CRITICIDADE_PCT}%`;return fe!==J.e&&ue(Z,J.e=fe),J.t=Fe(Z,Se,J.t),J},{e:void 0,t:void 0}),s}}),null),e(i,l(re,{get when(){return Te()},get children(){var s=pl(),n=s.firstChild,h=n.firstChild,C=h.firstChild,E=C.firstChild,o=E.firstChild,I=o.firstChild,f=o.nextSibling,y=f.firstChild,O=y.nextSibling;O.nextSibling;var T=E.nextSibling,M=h.nextSibling,_=M.firstChild,R=_.firstChild,u=R.nextSibling,p=_.nextSibling,W=M.nextSibling,L=W.firstChild,G=L.firstChild,j=G.nextSibling,V=j.firstChild,oe=L.nextSibling;return s.$$click=a=>a.target===a.currentTarget&&Ne(null),e(o,l(Le,{size:24,class:"text-red-500"}),I),e(o,Te,null),e(f,()=>Ce().length,y),e(f,()=>Ce().filter(a=>a.CRITICIDADE_PCT>=75).length,O),T.$$click=()=>Ne(null),e(T,l(Oe,{size:20})),e(u,l(ve,{get each(){return Ce()},children:a=>(()=>{var w=$l(),P=w.firstChild,U=P.nextSibling,Q=U.nextSibling,q=Q.firstChild,X=q.firstChild,v=X.nextSibling,K=Q.nextSibling,B=K.firstChild,H=B.firstChild,Y=K.nextSibling,xe=Y.firstChild,ie=Y.nextSibling,ae=ie.nextSibling,ne=ae.firstChild;return e(P,()=>a.PRODUTO),e(U,()=>a.NOME),e(X,()=>a.UNE),e(v,()=>a.UNE_NOME),e(B,()=>a.CRITICIDADE_PCT.toFixed(0),H),e(Y,()=>m(a.NECESSIDADE),xe),e(ie,()=>m(a.VENDA_30DD)),e(ae,()=>m(a.ESTOQUE_UNE),ne),e(ae,()=>m(a.ESTOQUE_LV),null),le(z=>{var de=a.NOME,Z=a.UNE_NOME,ce=`px-2 py-0.5 rounded text-xs font-bold ${a.CRITICIDADE_PCT>=75?"bg-red-500/20 text-red-500":a.CRITICIDADE_PCT>=50?"bg-orange-500/20 text-orange-500":a.CRITICIDADE_PCT>=25?"bg-yellow-500/20 text-yellow-500":"bg-blue-500/20 text-blue-500"}`;return de!==z.e&&te(U,"title",z.e=de),Z!==z.t&&te(v,"title",z.t=Z),ce!==z.a&&ue(B,z.a=ce),z},{e:void 0,t:void 0,a:void 0}),w})()})),e(p,l(ve,{get each(){return Ce()},children:a=>(()=>{var w=El(),P=w.firstChild,U=P.firstChild,Q=U.firstChild,q=Q.nextSibling;q.firstChild;var X=U.nextSibling,v=X.firstChild,K=P.nextSibling,B=K.firstChild,H=B.firstChild,Y=H.nextSibling,xe=B.nextSibling,ie=xe.firstChild,ae=ie.nextSibling,ne=K.nextSibling,z=ne.firstChild,de=z.firstChild,Z=de.nextSibling,ce=Z.firstChild,ee=z.nextSibling,J=ee.firstChild,fe=J.nextSibling,Se=ne.nextSibling,Lt=Se.firstChild,Ue=Lt.nextSibling,jt=Ue.firstChild;return e(Q,()=>a.NOME),e(q,()=>a.PRODUTO,null),e(X,()=>a.CRITICIDADE_PCT.toFixed(0),v),e(Y,()=>a.UNE),e(ae,()=>a.UNE_NOME),e(Z,()=>m(a.NECESSIDADE),ce),e(fe,()=>m(a.VENDA_30DD)),e(Ue,()=>m(a.ESTOQUE_UNE),jt),e(Ue,()=>m(a.ESTOQUE_LV),null),le(()=>ue(X,`px-2 py-1 rounded text-xs font-bold shrink-0 ml-2 ${a.CRITICIDADE_PCT>=75?"bg-red-500/20 text-red-500":a.CRITICIDADE_PCT>=50?"bg-orange-500/20 text-orange-500":a.CRITICIDADE_PCT>=25?"bg-yellow-500/20 text-yellow-500":"bg-blue-500/20 text-blue-500"}`)),w})()})),e(M,l(re,{get when(){return Ce().length===0},get children(){var a=fl(),w=a.firstChild;return e(a,l(Le,{size:48,class:"mx-auto mb-2 opacity-50"}),w),a}}),null),e(j,()=>m(Ce().reduce((a,w)=>a+w.NECESSIDADE,0)),V),oe.$$click=()=>Ne(null),le(()=>te(_,"aria-label",`Produtos em ruptura do grupo ${Te()}`)),s}}),null),e(i,l(re,{get when(){return!se()},get fallback(){return(()=>{var s=Sl(),n=s.firstChild;return e(s,l(ot,{class:"animate-spin mx-auto mb-4",size:32}),n),s})()},get children(){return l(re,{get when(){return!F()},get fallback(){return(()=>{var s=Dl(),n=s.firstChild,h=n.firstChild,C=h.nextSibling;return e(s,l(ke,{size:24}),n),e(C,F),s})()},get children(){return l(re,{get when(){return g().length>0},get fallback(){return(()=>{var s=Il();return e(s,l(dl,{title:"Nenhuma ruptura cr√≠tica detectada!",description:"Todos os produtos de alta venda possuem estoque adequado."})),s})()},get children(){return[(()=>{var s=hl(),n=s.firstChild,h=n.firstChild,C=h.firstChild,E=C.nextSibling;return e(E,l(ve,{get each(){return g()},children:o=>(()=>{var I=yl(),f=I.firstChild,y=f.firstChild,O=y.nextSibling,T=f.nextSibling,M=T.firstChild,_=M.firstChild,R=_.nextSibling,u=T.nextSibling,p=u.firstChild,W=u.nextSibling,L=W.firstChild,G=W.nextSibling,j=G.nextSibling,V=j.nextSibling,oe=V.firstChild,a=V.nextSibling,w=a.firstChild,P=w.firstChild,U=P.nextSibling,Q=U.firstChild,q=U.nextSibling,X=q.firstChild;return e(y,()=>o.NOME),e(O,()=>o.PRODUTO),e(_,()=>o.UNE),e(R,()=>o.UNE_NOME),e(p,l(ze,{size:14}),null),e(p,()=>Math.round(o.VENDA_30DD),null),e(L,l(nt,{size:14}),null),e(L,()=>Math.round(o.ESTOQUE_UNE),null),e(G,()=>Math.round(o.ESTOQUE_CD)),e(j,()=>Math.round(o.ESTOQUE_LV)),e(V,()=>Math.round(o.NECESSIDADE),oe),e(P,()=>Ze(o.CRITICIDADE_PCT)),e(q,()=>o.CRITICIDADE_PCT.toFixed(0),X),le(v=>{var K=o.UNE_NOME,B=`px-2 py-1 rounded-full text-xs font-bold border ${Ye(o.CRITICIDADE_PCT)}`,H=`h-1.5 rounded-full ${o.CRITICIDADE_PCT>=75?"bg-red-500":o.CRITICIDADE_PCT>=50?"bg-orange-500":o.CRITICIDADE_PCT>=25?"bg-yellow-500":"bg-blue-500"}`,Y=`width: ${o.CRITICIDADE_PCT}%`;return K!==v.e&&te(R,"title",v.e=K),B!==v.t&&ue(P,v.t=B),H!==v.a&&ue(Q,v.a=H),v.o=Fe(Q,Y,v.o),v},{e:void 0,t:void 0,a:void 0,o:void 0}),I})()})),s})(),(()=>{var s=ml();return e(s,l(ve,{get each(){return g()},children:n=>(()=>{var h=Tl(),C=h.firstChild,E=C.firstChild,o=E.firstChild,I=o.nextSibling;I.firstChild;var f=E.nextSibling,y=C.nextSibling,O=y.firstChild,T=O.nextSibling,M=y.nextSibling,_=M.firstChild,R=_.firstChild,u=R.nextSibling,p=u.firstChild,W=_.nextSibling,L=W.firstChild,G=M.nextSibling,j=G.firstChild,V=j.firstChild,oe=V.firstChild,a=V.nextSibling,w=a.firstChild,P=j.nextSibling,U=P.firstChild,Q=U.firstChild,q=U.nextSibling,X=q.firstChild,v=P.nextSibling,K=v.firstChild,B=K.nextSibling,H=B.firstChild,Y=v.nextSibling,xe=Y.firstChild,ie=xe.nextSibling,ae=ie.firstChild,ne=G.nextSibling,z=ne.firstChild,de=z.firstChild,Z=de.nextSibling,ce=Z.firstChild;return e(o,()=>n.NOME),e(I,()=>n.PRODUTO,null),e(f,()=>Ze(n.CRITICIDADE_PCT)),e(O,()=>n.UNE),e(T,()=>n.UNE_NOME),e(u,()=>n.CRITICIDADE_PCT.toFixed(0),p),e(V,l(ze,{size:12}),oe),e(a,()=>Math.round(n.VENDA_30DD),w),e(U,l(nt,{size:12}),Q),e(q,()=>Math.round(n.ESTOQUE_UNE),X),e(B,()=>Math.round(n.ESTOQUE_CD),H),e(ie,()=>Math.round(n.ESTOQUE_LV),ae),e(Z,()=>Math.round(n.NECESSIDADE),ce),le(ee=>{var J=`px-2 py-1 rounded-full text-xs font-bold border shrink-0 ${Ye(n.CRITICIDADE_PCT)}`,fe=`h-2 rounded-full ${n.CRITICIDADE_PCT>=75?"bg-red-500":n.CRITICIDADE_PCT>=50?"bg-orange-500":n.CRITICIDADE_PCT>=25?"bg-yellow-500":"bg-blue-500"}`,Se=`width: ${n.CRITICIDADE_PCT}%`;return J!==ee.e&&ue(f,ee.e=J),fe!==ee.t&&ue(L,ee.t=fe),ee.a=Fe(L,Se,ee.a),ee},{e:void 0,t:void 0,a:void 0}),h})()})),s})()]}})}})}}),null),le(s=>{var n=$e()?"Ocultar filtros":"Mostrar filtros",h=$e(),C=g().length===0,E=g().length===0,o=se(),I=se()?"Atualizando rupturas cr√≠ticas":"Atualizar rupturas cr√≠ticas",f=se();return n!==s.e&&te(t,"aria-label",s.e=n),h!==s.t&&te(t,"aria-expanded",s.t=h),C!==s.a&&(D.disabled=s.a=C),E!==s.o&&(N.disabled=s.o=E),o!==s.i&&(_e.disabled=s.i=o),I!==s.n&&te(_e,"aria-label",s.n=I),f!==s.s&&te(_e,"aria-busy",s.s=f),s},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0,n:void 0,s:void 0}),i}})}ut(["click"]);export{Ll as default};
