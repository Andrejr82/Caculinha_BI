{"timestamp": "2025-11-20T10:10:10.838689", "query": "\n            \n            **TAREFA:** Voc√™ deve escrever um script Python para responder √† pergunta do usu√°rio.\n\n            **INSTRU√á√ïES OBRIGAT√ìRIAS:**\n            1. **CARREGUE OS DADOS:** Inicie seu script com a linha: `df = load_data()`\n            2. **RESPONDA √Ä PERGUNTA:** Usando o dataframe `df`, escreva o c√≥digo para responder √† seguinte pergunta: \"Assistant: Ol√°! Eu sou a Ca√ßulinha, sua assistente de BI. O que vamos analisar hoje?\nAssistant: ola bom dia tudo bem\nAssistant: Oi! Bom dia pra voc√™ tamb√©m! üòä Por aqui t√° tudo √≥timo, obrigada por perguntar! E voc√™, como t√°? Me conta, o que a gente vai ver de dados hoje? T√¥ curiosa!\nAssistant: gr√°fico de barras de todos os segmentos da une scr\"\n            3. **SALVE O RESULTADO NA VARI√ÅVEL `result`:** A √∫ltima linha do seu script DEVE ser a atribui√ß√£o do resultado final √† vari√°vel `result`. Esta √© a √∫nica forma que o sistema tem para ver sua resposta. N√ÉO use `print()`.\n\n            **REGRAS OBRIGAT√ìRIAS:**\n            1. **SEMPRE defina vari√°veis antes de usar:** Se usar `produto_id`, defina antes (ex: `produto_id = 369947`)\n            2. **Produtos em Excesso:** Filtre `estoque_atual > linha_verde`\n            3. **\"linha verde\" N√ÉO √© segmento:** √â uma COLUNA (linha_verde) que indica meta de estoque\n            4. **Produtos que precisam ajuste na linha verde:** Filtre onde `estoque_atual != linha_verde`\n            5. **UNE:** Filtre por `une_nome` (ex: 'BON', 'TAQ', 'TIJ'), N√ÉO por c√≥digo num√©rico\n            6. **An√°lise Temporal:** Dataset s√≥ tem venda_30_d (√∫ltimos 30 dias). N√ÉO h√° colunas de m√™s/trimestre\n            7. **\"em todas as UNEs\":** Use merge para incluir UNEs com venda = 0\n            8. **Top N:** Use `.head(N)` ap√≥s ordenar, ou `.nlargest(N, coluna)`\n\n            **Exemplo 1 - Top 10 produtos por UNE:**\n            ```python\n            df = load_data()\n            # Filtrar UNE (use nome em mai√∫sculas)\n            df_une = df[df['une_nome'].str.upper() == 'TIJ']\n            # Top 10 por vendas\n            top10 = df_une.nlargest(10, 'venda_30_d')[['nome_produto', 'venda_30_d']]\n            result = top10\n            ```\n\n            **Exemplo 2 - Produtos precisando ajuste na linha verde:**\n            ```python\n            df = load_data()\n            # Filtrar UNE\n            df_une = df[df['une_nome'].str.upper() == 'BON']\n            # linha_verde √© COLUNA, n√£o segmento!\n            df_ajuste = df_une[df_une['estoque_atual'] != df_une['linha_verde']]\n            result = df_ajuste[['nome_produto', 'estoque_atual', 'linha_verde']]\n            ```\n\n            **Exemplo 3 - Segmentos por vendas (N√ÉO h√° dados temporais):**\n            ```python\n            df = load_data()\n            # Filtrar UNE\n            df_une = df[df['une_nome'].str.upper() == 'TAQ']\n            # Agrupar por segmento (s√≥ temos venda_30_d, sem hist√≥rico mensal!)\n            segmentos = df_une.groupby('nomesegmento')['venda_30_d'].sum().sort_values(ascending=False)\n            result = segmentos.reset_index()\n            ```\n\n\n\n            **Seu Script Python (Lembre-se, a √∫ltima linha deve ser `result = ...`):**\n            ", "code": "import plotly.express as px\nimport pandas as pd\n\n# Carrega os dados (esta fun√ß√£o √© fornecida pelo ambiente de execu√ß√£o)\ndf = load_data()\n\n# Define a UNE a ser analisada a partir da query do usu√°rio\nune_alvo = 'SCR'\n\n# Verifica se a coluna 'une_nome' existe para realizar o filtro\nif 'une_nome' in df.columns:\n    # Filtra o DataFrame para conter apenas os dados da UNE 'SCR'\n    # Usar .str.upper() torna a compara√ß√£o insens√≠vel a mai√∫sculas/min√∫sculas\n    df_une = df[df['une_nome'].str.upper() == une_alvo]\nelse:\n    # Se a coluna de UNE n√£o existir, assume-se que o dataset j√° est√° filtrado ou √© geral\n    df_une = df\n\n# Verifica se as colunas necess√°rias para a an√°lise existem\nif 'nomesegmento' in df_une.columns and 'venda_30_d' in df_une.columns:\n    # Agrupa os dados por segmento e soma as vendas dos √∫ltimos 30 dias\n    vendas_segmento = df_une.groupby('nomesegmento')['venda_30_d'].sum().reset_index()\n\n    # Ordena os segmentos pelo total de vendas em ordem decrescente para melhor visualiza√ß√£o\n    vendas_segmento = vendas_segmento.sort_values(by='venda_30_d', ascending=False)\n    \n    # Remove segmentos com vendas nulas ou zero para um gr√°fico mais limpo\n    vendas_segmento = vendas_segmento[vendas_segmento['venda_30_d'] > 0]\n\n    # Cria o gr√°fico de barras interativo com Plotly Express\n    fig = px.bar(\n        vendas_segmento,\n        x='nomesegmento',\n        y='venda_30_d',\n        title=f'Total de Vendas por Segmento na UNE {une_alvo}',\n        labels={'nomesegmento': 'Segmento', 'venda_30_d': 'Vendas nos √öltimos 30 Dias'},\n        text_auto='.2s'  # Formata os r√≥tulos de dados para serem mais leg√≠veis (ex: 1.5k)\n    )\n\n    # Atualiza o layout para melhorar a legibilidade\n    fig.update_layout(\n        xaxis_title=\"Segmento\",\n        yaxis_title=\"Total de Vendas (R$)\",\n        xaxis={'categoryorder':'total descending'} # Garante a ordem do maior para o menor\n    )\n    \n    # Atribui a figura do gr√°fico √† vari√°vel de resultado\n    result = fig\nelse:\n    # Caso as colunas necess√°rias n√£o existam, retorna um dicion√°rio com uma mensagem de erro\n    result = {\"erro\": \"As colunas 'nomesegmento' e/ou 'venda_30_d' n√£o foram encontradas no DataFrame.\"}", "rows": 1, "success": true}
{"timestamp": "2025-11-20T10:56:04.143579", "query": "\n            \n            **TAREFA:** Voc√™ deve escrever um script Python para responder √† pergunta do usu√°rio.\n\n            **INSTRU√á√ïES OBRIGAT√ìRIAS:**\n            1. **CARREGUE OS DADOS:** Inicie seu script com a linha: `df = load_data()`\n            2. **RESPONDA √Ä PERGUNTA:** Usando o dataframe `df`, escreva o c√≥digo para responder √† seguinte pergunta: \"Assistant: Voc√™ foi desconectado. Fa√ßa login para continuar.\nAssistant: bom dia, tudo bem.\nAssistant: Bom dia! Tudo bem por aqui, sim! E com voc√™? üòä\n\nAh, vi que voc√™ foi desconectado. Conseguiu logar de novo ou t√° precisando de uma m√£ozinha com isso?\nAssistant: estou bem, mas preocupado com as vendas de chamex nas unes, preciso da sua ajuda. gere um gr√°fico que eu cnsiga comparar as vendaas em todas  as unes\"\n            3. **SALVE O RESULTADO NA VARI√ÅVEL `result`:** A √∫ltima linha do seu script DEVE ser a atribui√ß√£o do resultado final √† vari√°vel `result`. Esta √© a √∫nica forma que o sistema tem para ver sua resposta. N√ÉO use `print()`.\n\n            **REGRAS OBRIGAT√ìRIAS:**\n            1. **SEMPRE defina vari√°veis antes de usar:** Se usar `produto_id`, defina antes (ex: `produto_id = 369947`)\n            2. **Produtos em Excesso:** Filtre `estoque_atual > linha_verde`\n            3. **\"linha verde\" N√ÉO √© segmento:** √â uma COLUNA (linha_verde) que indica meta de estoque\n            4. **Produtos que precisam ajuste na linha verde:** Filtre onde `estoque_atual != linha_verde`\n            5. **UNE:** Filtre por `une_nome` (ex: 'BON', 'TAQ', 'TIJ'), N√ÉO por c√≥digo num√©rico\n            6. **An√°lise Temporal:** Dataset s√≥ tem venda_30_d (√∫ltimos 30 dias). N√ÉO h√° colunas de m√™s/trimestre\n            7. **\"em todas as UNEs\":** Use merge para incluir UNEs com venda = 0\n            8. **Top N:** Use `.head(N)` ap√≥s ordenar, ou `.nlargest(N, coluna)`\n\n            **Exemplo 1 - Top 10 produtos por UNE:**\n            ```python\n            df = load_data()\n            # Filtrar UNE (use nome em mai√∫sculas)\n            df_une = df[df['une_nome'].str.upper() == 'TIJ']\n            # Top 10 por vendas\n            top10 = df_une.nlargest(10, 'venda_30_d')[['nome_produto', 'venda_30_d']]\n            result = top10\n            ```\n\n            **Exemplo 2 - Produtos precisando ajuste na linha verde:**\n            ```python\n            df = load_data()\n            # Filtrar UNE\n            df_une = df[df['une_nome'].str.upper() == 'BON']\n            # linha_verde √© COLUNA, n√£o segmento!\n            df_ajuste = df_une[df_une['estoque_atual'] != df_une['linha_verde']]\n            result = df_ajuste[['nome_produto', 'estoque_atual', 'linha_verde']]\n            ```\n\n            **Exemplo 3 - Segmentos por vendas (N√ÉO h√° dados temporais):**\n            ```python\n            df = load_data()\n            # Filtrar UNE\n            df_une = df[df['une_nome'].str.upper() == 'TAQ']\n            # Agrupar por segmento (s√≥ temos venda_30_d, sem hist√≥rico mensal!)\n            segmentos = df_une.groupby('nomesegmento')['venda_30_d'].sum().sort_values(ascending=False)\n            result = segmentos.reset_index()\n            ```\n\n\n\n            **Seu Script Python (Lembre-se, a √∫ltima linha deve ser `result = ...`):**\n            ", "code": "import pandas as pd\nimport plotly.express as px\n\n# 1. CARREGUE OS DADOS\n# Inicia o script carregando o dataframe.\ndf = load_data()\n\n# 2. RESPONDA √Ä PERGUNTA\n# O objetivo √© criar um gr√°fico comparando as vendas do fabricante 'CHAMEX' em todas as UNEs.\n\n# Valida√ß√£o para garantir que as colunas necess√°rias existem no dataframe.\nif 'NOMEFABRICANTE' in df.columns and 'une_nome' in df.columns and 'venda_30_d' in df.columns:\n    \n    # Filtra os dados para incluir apenas produtos do fabricante 'CHAMEX'.\n    # Usamos .str.upper() para garantir a correspond√™ncia independentemente do case.\n    df_chamex = df[df['NOMEFABRICANTE'].str.upper() == 'CHAMEX'].copy()\n\n    # Agrupa os dados por UNE e soma as vendas dos √∫ltimos 30 dias.\n    # Isso totaliza as vendas de todos os produtos Chamex para cada UNE.\n    vendas_por_une = df_chamex.groupby('une_nome')['venda_30_d'].sum().reset_index()\n\n    # Para garantir que todas as UNEs apare√ßam no gr√°fico (mesmo com vendas zero de Chamex),\n    # criamos uma lista de todas as UNEs existentes no dataset original.\n    todas_as_unes = pd.DataFrame(df['une_nome'].unique(), columns=['une_nome'])\n\n    # Unimos a lista de todas as UNEs com os dados de vendas de Chamex.\n    # Usamos um 'left' merge para manter todas as UNEs da lista da esquerda.\n    df_final = pd.merge(todas_as_unes, vendas_por_une, on='une_nome', how='left')\n\n    # As UNEs que n√£o venderam Chamex ter√£o o valor NaN (Not a Number) ap√≥s o merge.\n    # Substitu√≠mos esses NaNs por 0.\n    df_final['venda_30_d'] = df_final['venda_30_d'].fillna(0)\n\n    # Ordena os dados pelas vendas em ordem decrescente para melhor visualiza√ß√£o no gr√°fico.\n    df_final = df_final.sort_values(by='venda_30_d', ascending=False)\n\n    # Cria o gr√°fico de barras usando Plotly Express.\n    fig = px.bar(\n        df_final,\n        x='une_nome',\n        y='venda_30_d',\n        title='Comparativo de Vendas de Chamex por UNE (√öltimos 30 dias)',\n        labels={'une_nome': 'Unidade de Neg√≥cio (UNE)', 'venda_30_d': 'Total de Vendas'},\n        text_auto=True  # Adiciona os valores de venda diretamente nas barras.\n    )\n\n    # Ajusta o layout do gr√°fico para clareza.\n    fig.update_layout(\n        xaxis_title=\"UNE\",\n        yaxis_title=\"Vendas (30 dias)\",\n        title_x=0.5\n    )\n\n    # 3. SALVE O RESULTADO NA VARI√ÅVEL `result`\n    # O gr√°fico gerado √© o resultado final a ser retornado.\n    result = fig\n\nelse:\n    # Caso alguma coluna essencial n√£o exista, retorna uma mensagem de erro.\n    result = {\"error\": \"Colunas necess√°rias ('NOMEFABRICANTE', 'une_nome', 'venda_30_d') n√£o encontradas.\"}", "rows": 1, "success": true}
{"timestamp": "2025-11-20T11:04:23.711630", "query": "\n            \n            **TAREFA:** Voc√™ deve escrever um script Python para responder √† pergunta do usu√°rio.\n\n            **INSTRU√á√ïES OBRIGAT√ìRIAS:**\n            1. **CARREGUE OS DADOS:** Inicie seu script com a linha: `df = load_data()`\n            2. **RESPONDA √Ä PERGUNTA:** Usando o dataframe `df`, escreva o c√≥digo para responder √† seguinte pergunta: \"Assistant: Voc√™ foi desconectado. Fa√ßa login para continuar.\nAssistant: bom dia, tudo bem.\nAssistant: Bom dia! Tudo bem por aqui, sim! E com voc√™? üòä\n\nAh, vi que voc√™ foi desconectado. Conseguiu logar de novo ou t√° precisando de uma m√£ozinha com isso?\nAssistant: estou bem, mas preocupado com as vendas de chamex nas unes, preciso da sua ajuda. gere um gr√°fico que eu cnsiga comparar as vendaas em todas  as unes\nAssistant: ...\nAssistant: gere esse gr√°fico em outro modelo\"\n            3. **SALVE O RESULTADO NA VARI√ÅVEL `result`:** A √∫ltima linha do seu script DEVE ser a atribui√ß√£o do resultado final √† vari√°vel `result`. Esta √© a √∫nica forma que o sistema tem para ver sua resposta. N√ÉO use `print()`.\n\n            **REGRAS OBRIGAT√ìRIAS:**\n            1. **SEMPRE defina vari√°veis antes de usar:** Se usar `produto_id`, defina antes (ex: `produto_id = 369947`)\n            2. **Produtos em Excesso:** Filtre `estoque_atual > linha_verde`\n            3. **\"linha verde\" N√ÉO √© segmento:** √â uma COLUNA (linha_verde) que indica meta de estoque\n            4. **Produtos que precisam ajuste na linha verde:** Filtre onde `estoque_atual != linha_verde`\n            5. **UNE:** Filtre por `une_nome` (ex: 'BON', 'TAQ', 'TIJ'), N√ÉO por c√≥digo num√©rico\n            6. **An√°lise Temporal:** Dataset s√≥ tem venda_30_d (√∫ltimos 30 dias). N√ÉO h√° colunas de m√™s/trimestre\n            7. **\"em todas as UNEs\":** Use merge para incluir UNEs com venda = 0\n            8. **Top N:** Use `.head(N)` ap√≥s ordenar, ou `.nlargest(N, coluna)`\n\n            **Exemplo 1 - Top 10 produtos por UNE:**\n            ```python\n            df = load_data()\n            # Filtrar UNE (use nome em mai√∫sculas)\n            df_une = df[df['une_nome'].str.upper() == 'TIJ']\n            # Top 10 por vendas\n            top10 = df_une.nlargest(10, 'venda_30_d')[['nome_produto', 'venda_30_d']]\n            result = top10\n            ```\n\n            **Exemplo 2 - Produtos precisando ajuste na linha verde:**\n            ```python\n            df = load_data()\n            # Filtrar UNE\n            df_une = df[df['une_nome'].str.upper() == 'BON']\n            # linha_verde √© COLUNA, n√£o segmento!\n            df_ajuste = df_une[df_une['estoque_atual'] != df_une['linha_verde']]\n            result = df_ajuste[['nome_produto', 'estoque_atual', 'linha_verde']]\n            ```\n\n            **Exemplo 3 - Segmentos por vendas (N√ÉO h√° dados temporais):**\n            ```python\n            df = load_data()\n            # Filtrar UNE\n            df_une = df[df['une_nome'].str.upper() == 'TAQ']\n            # Agrupar por segmento (s√≥ temos venda_30_d, sem hist√≥rico mensal!)\n            segmentos = df_une.groupby('nomesegmento')['venda_30_d'].sum().sort_values(ascending=False)\n            result = segmentos.reset_index()\n            ```\n\n\n\n            **Seu Script Python (Lembre-se, a √∫ltima linha deve ser `result = ...`):**\n            ", "code": "import pandas as pd\nimport plotly.express as px\n\n# Carrega os dados da UNE\ndf = load_data()\n\n# Define o fabricante a ser analisado\nfabricante_alvo = 'CHAMEX'\n\n# Verifica se as colunas necess√°rias existem no DataFrame\nif 'NOMEFABRICANTE' in df.columns and 'une_nome' in df.columns and 'venda_30_d' in df.columns:\n    \n    # Filtra os dados para incluir apenas produtos do fabricante 'CHAMEX'\n    # Usamos .str.contains para ser flex√≠vel com varia√ß√µes no nome (ex: 'CHAMEX LTDA')\n    df_fabricante = df[df['NOMEFABRICANTE'].str.contains(fabricante_alvo, case=False, na=False)]\n\n    # Verifica se foram encontrados dados para o fabricante\n    if not df_fabricante.empty:\n        # Agrupa os dados por UNE e soma as vendas dos √∫ltimos 30 dias\n        vendas_por_une = df_fabricante.groupby('une_nome')['venda_30_d'].sum().head(10).reset_index()\n        \n        # Filtra para garantir que apenas UNEs com vendas sejam exibidas no gr√°fico\n        vendas_por_une = vendas_por_une[vendas_por_une['venda_30_d'] > 0]\n\n        # Gera um gr√°fico de Treemap (mapa de calor hier√°rquico) como um \"outro modelo\"\n        # Este tipo de gr√°fico √© excelente para comparar propor√ß√µes\n        fig = px.treemap(\n            vendas_por_une,\n            path=[px.Constant(\"Todas as UNEs\"), 'une_nome'],  # Define a hierarquia do gr√°fico\n            values='venda_30_d',  # Define os valores que determinar√£o o tamanho de cada ret√¢ngulo\n            title=f'Distribui√ß√£o de Vendas de {fabricante_alvo} por UNE (√öltimos 30 dias)',\n            color='venda_30_d',  # Colore os ret√¢ngulos com base no volume de vendas\n            color_continuous_scale='Blues',  # Define a escala de cores\n            hover_data={'venda_30_d': ':.2f'} # Formata o valor no hover\n        )\n        \n        # Melhora a visualiza√ß√£o das informa√ß√µes dentro de cada ret√¢ngulo\n        fig.update_traces(textinfo=\"label+value\", textfont_size=14)\n        fig.update_layout(margin = dict(t=50, l=25, r=25, b=25))\n\n        # Atribui a figura gerada √† vari√°vel de resultado\n        result = fig\n    else:\n        # Caso nenhum produto do fabricante seja encontrado\n        result = {\"message\": f\"N√£o foram encontrados dados de vendas para o fabricante '{fabricante_alvo}'.\"}\nelse:\n    # Caso as colunas necess√°rias n√£o existam\n    result = {\"message\": \"As colunas 'NOMEFABRICANTE', 'une_nome' ou 'venda_30_d' n√£o foram encontradas no dataset.\"}", "rows": 1, "success": true}
{"timestamp": "2025-11-20T12:53:04.924266", "query": "\n            \n            **TAREFA:** Voc√™ deve escrever um script Python para responder √† pergunta do usu√°rio.\n\n            **INSTRU√á√ïES OBRIGAT√ìRIAS:**\n            1. **CARREGUE OS DADOS:** Inicie seu script com a linha: `df = load_data()`\n            2. **RESPONDA √Ä PERGUNTA:** Usando o dataframe `df`, escreva o c√≥digo para responder √† seguinte pergunta: \"Assistant: Ol√°! Eu sou a Ca√ßulinha, sua assistente de BI. O que vamos analisar hoje?\nAssistant: boa tadre. estou preocupado com o abstecimento dos TNTs nas lojas\nAssistant: Ih, abastecimento √© algo que a gente precisa ver rapidinho mesmo! Fica tranquilo(a), vou te ajudar com isso. Pra eu dar uma olhada certinha, me diz uma coisa: quais lojas e qual per√≠odo te preocupam mais? E o que exatamente voc√™ quer ver? Se √© o estoque, as entregas que est√£o atrasando, ou se t√° faltando produto na prateleira... Me fala a√≠ que eu j√° corro atr√°s! üèÉ‚Äç‚ôÄÔ∏èüí®\nAssistant: quero saber se as entregas nas lojas do tnt branco e preto est√° ok, sem ruptura\nAssistant: Ah, entendi perfeitamente! TNT branco e preto, ver se as entregas est√£o direitinho e se n√£o tem ruptura. Perfeito, j√° anotado!\n\nPra eu conseguir puxar essa informa√ß√£o *certinha* pra voc√™, e a gente n√£o perder tempo, me diz uma coisa: quais lojas voc√™ quer que eu veja e qual o per√≠odo? Assim a gente j√° vai direto ao ponto! üòâ\nAssistant: quero das lojas bar,261 e scr\nAssistant: 'list' object has no attribute 'get'\nAssistant: quero das lojas bar,261 e scr\nAssistant: 'list' object has no attribute 'get'\nAssistant: quero das lojas bar,261 e scr\"\n            3. **SALVE O RESULTADO NA VARI√ÅVEL `result`:** A √∫ltima linha do seu script DEVE ser a atribui√ß√£o do resultado final √† vari√°vel `result`. Esta √© a √∫nica forma que o sistema tem para ver sua resposta. N√ÉO use `print()`.\n\n            **REGRAS OBRIGAT√ìRIAS:**\n            1. **SEMPRE defina vari√°veis antes de usar:** Se usar `produto_id`, defina antes (ex: `produto_id = 369947`)\n            2. **Produtos em Excesso:** Filtre `estoque_atual > linha_verde`\n            3. **\"linha verde\" N√ÉO √© segmento:** √â uma COLUNA (linha_verde) que indica meta de estoque\n            4. **Produtos que precisam ajuste na linha verde:** Filtre onde `estoque_atual != linha_verde`\n            5. **UNE:** Filtre por `une_nome` (ex: 'BON', 'TAQ', 'TIJ'), N√ÉO por c√≥digo num√©rico\n            6. **An√°lise Temporal:** Dataset s√≥ tem venda_30_d (√∫ltimos 30 dias). N√ÉO h√° colunas de m√™s/trimestre\n            7. **\"em todas as UNEs\":** Use merge para incluir UNEs com venda = 0\n            8. **Top N:** Use `.head(N)` ap√≥s ordenar, ou `.nlargest(N, coluna)`\n\n            **Exemplo 1 - Top 10 produtos por UNE:**\n            ```python\n            df = load_data()\n            # Filtrar UNE (use nome em mai√∫sculas)\n            df_une = df[df['une_nome'].str.upper() == 'TIJ']\n            # Top 10 por vendas\n            top10 = df_une.nlargest(10, 'venda_30_d')[['nome_produto', 'venda_30_d']]\n            result = top10\n            ```\n\n            **Exemplo 2 - Produtos precisando ajuste na linha verde:**\n            ```python\n            df = load_data()\n            # Filtrar UNE\n            df_une = df[df['une_nome'].str.upper() == 'BON']\n            # linha_verde √© COLUNA, n√£o segmento!\n            df_ajuste = df_une[df_une['estoque_atual'] != df_une['linha_verde']]\n            result = df_ajuste[['nome_produto', 'estoque_atual', 'linha_verde']]\n            ```\n\n            **Exemplo 3 - Segmentos por vendas (N√ÉO h√° dados temporais):**\n            ```python\n            df = load_data()\n            # Filtrar UNE\n            df_une = df[df['une_nome'].str.upper() == 'TAQ']\n            # Agrupar por segmento (s√≥ temos venda_30_d, sem hist√≥rico mensal!)\n            segmentos = df_une.groupby('nomesegmento')['venda_30_d'].sum().sort_values(ascending=False)\n            result = segmentos.reset_index()\n            ```\n\n\n\n            **Seu Script Python (Lembre-se, a √∫ltima linha deve ser `result = ...`):**\n            ", "code": "import pandas as pd\n\n# Carrega os dados (esta fun√ß√£o √© fornecida pelo ambiente de execu√ß√£o)\ndf = load_data()\n\n# Define os par√¢metros da an√°lise com base na solicita√ß√£o do usu√°rio\nunes_alvo = ['BAR', '261', 'SCR']\nproduto_keyword = 'TNT'\ncores_keywords = ['BRANCO', 'PRETO']\n\n# Verifica se as colunas essenciais para a an√°lise existem no DataFrame\nrequired_columns = ['une_nome', 'nome_produto', 'estoque_atual']\nif not all(col in df.columns for col in required_columns):\n    # Se alguma coluna estiver faltando, retorna uma mensagem de erro clara\n    result = {\"erro\": f\"Colunas necess√°rias n√£o encontradas. A an√°lise requer: {', '.join(required_columns)}.\"}\nelse:\n    # 1. Filtra o DataFrame para incluir apenas as UNEs (lojas) de interesse.\n    # O uso de .str.upper() garante que a compara√ß√£o n√£o seja sens√≠vel a mai√∫sculas/min√∫sculas.\n    df_unes = df[df['une_nome'].str.upper().isin(unes_alvo)].copy()\n\n    # 2. Filtra pelos produtos que cont√™m a palavra-chave 'TNT'.\n    # 'na=False' trata casos em que o nome do produto possa ser nulo.\n    df_tnt = df_unes[df_unes['nome_produto'].str.contains(produto_keyword, case=False, na=False)]\n\n    # 3. Filtra adicionalmente para os produtos que s√£o das cores 'BRANCO' ou 'PRETO'.\n    # O caractere '|' em regex atua como um 'OU', buscando por qualquer uma das palavras na lista.\n    filtro_cores = df_tnt['nome_produto'].str.contains('|'.join(cores_keywords), case=False, na=False)\n    df_produtos_alvo = df_tnt[filtro_cores]\n\n    # 4. Identifica os produtos em estado de ruptura, ou seja, com estoque atual menor ou igual a zero.\n    df_ruptura = df_produtos_alvo[df_produtos_alvo['estoque_atual'] <= 0]\n\n    # 5. Seleciona e ordena as colunas mais relevantes para apresentar o resultado.\n    # Se o DataFrame resultante estiver vazio, significa que n√£o h√° rupturas para os produtos e lojas consultados.\n    result_final = df_ruptura[['une_nome', 'nome_produto', 'estoque_atual', 'codigo']]\n    result = result_final.sort_values(by=['une_nome', 'nome_produto'])", "rows": 6, "success": true}
