{"timestamp": "2025-11-16T23:38:30.360366", "query": "\n            \n            **TAREFA:** Você deve escrever um script Python para responder à pergunta do usuário.\n\n            **INSTRUÇÕES OBRIGATÓRIAS:**\n            1. **CARREGUE OS DADOS:** Inicie seu script com a linha: `df = load_data()`\n            2. **RESPONDA À PERGUNTA:** Usando o dataframe `df`, escreva o código para responder à seguinte pergunta: \"Mostre a evolução de vendas mensais do produto 369947 nos últimos 12 meses\"\n            3. **SALVE O RESULTADO NA VARIÁVEL `result`:** A última linha do seu script DEVE ser a atribuição do resultado final à variável `result`. Esta é a única forma que o sistema tem para ver sua resposta. NÃO use `print()`.\n\n            **REGRAS OBRIGATÓRIAS:**\n            1. **SEMPRE defina variáveis antes de usar:** Se usar `produto_id`, defina antes (ex: `produto_id = 369947`)\n            2. **Produtos em Excesso:** Filtre `estoque_atual > linha_verde`\n            3. **\"linha verde\" NÃO é segmento:** É uma COLUNA (linha_verde) que indica meta de estoque\n            4. **Produtos que precisam ajuste na linha verde:** Filtre onde `estoque_atual != linha_verde`\n            5. **UNE:** Filtre por `une_nome` (ex: 'BON', 'TAQ', 'TIJ'), NÃO por código numérico\n            6. **Análise Temporal:** Dataset só tem venda_30_d (últimos 30 dias). NÃO há colunas de mês/trimestre\n            7. **\"em todas as UNEs\":** Use merge para incluir UNEs com venda = 0\n            8. **Top N:** Use `.head(N)` após ordenar, ou `.nlargest(N, coluna)`\n\n            **Exemplo 1 - Top 10 produtos por UNE:**\n            ```python\n            df = load_data()\n            # Filtrar UNE (use nome em maiúsculas)\n            df_une = df[df['une_nome'].str.upper() == 'TIJ']\n            # Top 10 por vendas\n            top10 = df_une.nlargest(10, 'venda_30_d')[['nome_produto', 'venda_30_d']]\n            result = top10\n            ```\n\n            **Exemplo 2 - Produtos precisando ajuste na linha verde:**\n            ```python\n            df = load_data()\n            # Filtrar UNE\n            df_une = df[df['une_nome'].str.upper() == 'BON']\n            # linha_verde é COLUNA, não segmento!\n            df_ajuste = df_une[df_une['estoque_atual'] != df_une['linha_verde']]\n            result = df_ajuste[['nome_produto', 'estoque_atual', 'linha_verde']]\n            ```\n\n            **Exemplo 3 - Segmentos por vendas (NÃO há dados temporais):**\n            ```python\n            df = load_data()\n            # Filtrar UNE\n            df_une = df[df['une_nome'].str.upper() == 'TAQ']\n            # Agrupar por segmento (só temos venda_30_d, sem histórico mensal!)\n            segmentos = df_une.groupby('nomesegmento')['venda_30_d'].sum().sort_values(ascending=False)\n            result = segmentos.reset_index()\n            ```\n\n\n\n            **Seu Script Python (Lembre-se, a última linha deve ser `result = ...`):**\n            ", "code": "df = load_data()\n\n# Definir o ID do produto a ser analisado\nproduto_id = 369947\n\n# Verificar se as colunas de vendas mensais existem no DataFrame\n# A regra 6 indica que o dataset SÓ tem venda_30_d e NÃO há colunas de mês/trimestre.\n# Portanto, a solicitação de \"evolução de vendas mensais nos últimos 12 meses\" não pode ser atendida diretamente.\n# A melhor abordagem é retornar a venda dos últimos 30 dias, pois é a única informação temporal disponível.\n\n# Filtrar o DataFrame para o produto específico\ndf_produto = df[df['codigo'] == produto_id]\n\n# Verificar se o produto foi encontrado\nif not df_produto.empty:\n    # Selecionar a coluna de vendas dos últimos 30 dias\n    # Como não há dados mensais, retornamos a venda_30_d como a métrica de vendas disponível.\n    vendas_disponiveis = df_produto[['nome_produto', 'venda_30_d']].copy()\n    \n    # Renomear a coluna para refletir que é a venda dos últimos 30 dias,\n    # já que a solicitação de \"mensal\" não pode ser atendida.\n    vendas_disponiveis.rename(columns={'venda_30_d': 'venda_ultimos_30_dias'}, inplace=True)\n    \n    # Adicionar uma coluna indicando que os dados são de 30 dias, para clareza\n    vendas_disponiveis['periodo'] = 'Últimos 30 dias'\n    \n    # A regra 7 (\"em todas as UNEs\": Use merge para incluir UNEs com venda = 0)\n    # não se aplica diretamente aqui, pois estamos focando em um produto específico\n    # e não em uma agregação por UNE. Se o produto não tiver venda em uma UNE,\n    # ele simplesmente não aparecerá no filtro inicial por 'codigo'.\n    # Se a intenção fosse mostrar o produto em todas as UNEs mesmo com venda 0,\n    # seria necessário um merge com uma lista de todas as UNEs, o que não é o foco principal da pergunta.\n    \n    result = vendas_disponiveis\nelse:\n    # Se o produto não for encontrado, retornar um DataFrame vazio ou uma mensagem.\n    # Retornar um DataFrame vazio é mais consistente com a expectativa de um resultado tabular.\n    result = pd.DataFrame(columns=['nome_produto', 'venda_ultimos_30_dias', 'periodo'])", "rows": 12, "success": true}
