{"timestamp": "2025-11-22T12:56:24.872254", "query": "\n            \n            **TAREFA:** Voc√™ deve escrever um script Python para responder √† pergunta do usu√°rio.\n\n            **INSTRU√á√ïES OBRIGAT√ìRIAS:**\n            1. **CARREGUE OS DADOS:** Inicie seu script com a linha: `df = load_data()`\n            2. **RESPONDA √Ä PERGUNTA:** Usando o dataframe `df`, escreva o c√≥digo para responder √† seguinte pergunta: \"Assistant: Ol√°! Eu sou a Ca√ßulinha, sua assistente de BI. O que vamos analisar hoje?\nAssistant: bom dia tudo bem\nAssistant: Bom dia! Tudo √≥timo por aqui, e com voc√™? Me conta, o que a gente vai ver hoje? üëÄ\nAssistant: preciso saber das vendas dos tns nas lojas\nAssistant: Ah, vendas de t√™nis nas lojas! Entendi! Bora ver isso! üòâ Voc√™ quer ver de todas as lojas, um per√≠odo espec√≠fico, ou tem algo mais em mente? Me conta a√≠ pra eu te ajudar direitinho!\nAssistant: a loja nao vende tenis\nAssistant: quero as vendas de tnts\"\n            3. **SALVE O RESULTADO NA VARI√ÅVEL `result`:** A √∫ltima linha do seu script DEVE ser a atribui√ß√£o do resultado final √† vari√°vel `result`. Esta √© a √∫nica forma que o sistema tem para ver sua resposta. N√ÉO use `print()`.\n\n            **REGRAS OBRIGAT√ìRIAS:**\n            1. **SEMPRE defina vari√°veis antes de usar:** Se usar `produto_id`, defina antes (ex: `produto_id = 369947`)\n            2. **Produtos em Excesso:** Filtre `estoque_atual > linha_verde`\n            3. **\"linha verde\" N√ÉO √© segmento:** √â uma COLUNA (linha_verde) que indica meta de estoque\n            4. **Produtos que precisam ajuste na linha verde:** Filtre onde `estoque_atual != linha_verde`\n            5. **UNE:** Filtre por `une_nome` (ex: 'BON', 'TAQ', 'TIJ'), N√ÉO por c√≥digo num√©rico\n            6. **An√°lise Temporal:** Dataset s√≥ tem venda_30_d (√∫ltimos 30 dias). N√ÉO h√° colunas de m√™s/trimestre\n            7. **\"em todas as UNEs\":** Use merge para incluir UNEs com venda = 0\n            8. **Top N:** Use `.head(N)` ap√≥s ordenar, ou `.nlargest(N, coluna)`\n\n            **Exemplo 1 - Top 10 produtos por UNE:**\n            ```python\n            df = load_data()\n            # Filtrar UNE (use nome em mai√∫sculas)\n            df_une = df[df['une_nome'].str.upper() == 'TIJ']\n            # Top 10 por vendas\n            top10 = df_une.nlargest(10, 'venda_30_d')[['nome_produto', 'venda_30_d']]\n            result = top10\n            ```\n\n            **Exemplo 2 - Produtos precisando ajuste na linha verde:**\n            ```python\n            df = load_data()\n            # Filtrar UNE\n            df_une = df[df['une_nome'].str.upper() == 'BON']\n            # linha_verde √© COLUNA, n√£o segmento!\n            df_ajuste = df_une[df_une['estoque_atual'] != df_une['linha_verde']]\n            result = df_ajuste[['nome_produto', 'estoque_atual', 'linha_verde']]\n            ```\n\n            **Exemplo 3 - Segmentos por vendas (N√ÉO h√° dados temporais):**\n            ```python\n            df = load_data()\n            # Filtrar UNE\n            df_une = df[df['une_nome'].str.upper() == 'TAQ']\n            # Agrupar por segmento (s√≥ temos venda_30_d, sem hist√≥rico mensal!)\n            segmentos = df_une.groupby('nomesegmento')['venda_30_d'].sum().sort_values(ascending=False)\n            result = segmentos.reset_index()\n            ```\n\n\n\n            **Seu Script Python (Lembre-se, a √∫ltima linha deve ser `result = ...`):**\n            ", "code": "import pandas as pd\n\n# Carrega os dados (esta fun√ß√£o √© fornecida pelo ambiente de execu√ß√£o)\ndf = load_data()\n\n# Palavra-chave para filtrar os produtos, baseada na solicita√ß√£o do usu√°rio (\"tnts\")\nproduto_keyword = 'TNT'\n\n# Lista de colunas necess√°rias para a an√°lise\nrequired_columns = ['nome_produto', 'venda_30_d', 'une_nome']\n\n# Valida√ß√£o: Verifica se todas as colunas necess√°rias existem no DataFrame\nif all(col in df.columns for col in required_columns):\n    \n    # 1. Filtra o DataFrame para encontrar produtos cujo nome cont√©m a palavra-chave 'TNT'.\n    #    'case=False' torna a busca insens√≠vel a mai√∫sculas/min√∫sculas.\n    #    'na=False' garante que valores nulos na coluna 'nome_produto' n√£o causem erro.\n    df_tnt = df[df['nome_produto'].str.contains(produto_keyword, case=False, na=False)].copy()\n\n    # Verifica se foram encontrados produtos com a palavra-chave\n    if not df_tnt.empty:\n        # 2. Agrupa os dados por loja ('une_nome') e soma as vendas dos √∫ltimos 30 dias ('venda_30_d')\n        #    para obter o total de vendas de TNT por loja.\n        vendas_tnt_por_loja = df_tnt.groupby('une_nome')['venda_30_d'].sum().head(10).reset_index()\n        \n        # 3. Ordena os resultados em ordem decrescente de vendas para destacar as lojas com melhor desempenho.\n        vendas_tnt_por_loja = vendas_tnt_por_loja.sort_values(by='venda_30_d', ascending=False)\n        \n        # 4. Filtra para remover lojas onde a venda de TNT foi zero ou nula, limpando o resultado.\n        vendas_tnt_por_loja = vendas_tnt_por_loja[vendas_tnt_por_loja['venda_30_d'] > 0]\n\n        # 5. Renomeia as colunas para maior clareza na apresenta√ß√£o do resultado final.\n        vendas_tnt_por_loja.rename(columns={\n            'une_nome': 'Loja',\n            'venda_30_d': 'Vendas de TNT (√öltimos 30 dias)'\n        }, inplace=True)\n\n        # Atribui o DataFrame final √† vari√°vel de resultado\n        result = vendas_tnt_por_loja\n    else:\n        # Caso nenhum produto com 'TNT' no nome seja encontrado, retorna uma mensagem informativa.\n        result = {\"mensagem\": f\"Nenhum produto contendo '{produto_keyword}' foi encontrado nos dados.\"}\nelse:\n    # Caso as colunas essenciais n√£o existam, retorna uma mensagem de erro clara.\n    result = {\"erro\": f\"As colunas necess√°rias ({', '.join(required_columns)}) n√£o foram encontradas no DataFrame.\"}", "rows": 10, "success": true}
