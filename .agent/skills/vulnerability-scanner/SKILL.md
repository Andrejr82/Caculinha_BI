---
name: vulnerability-scanner
description: PrincÃ­pios avanÃ§ados de anÃ¡lise de vulnerabilidade. OWASP 2025, SeguranÃ§a da Cadeia de Suprimentos, mapeamento de superfÃ­cie de ataque, priorizaÃ§Ã£o de risco.
allowed-tools: Read, Glob, Grep, Bash
---

# Scanner de Vulnerabilidades

> Pense como um atacante, defenda como um especialista. ConsciÃªncia do cenÃ¡rio de ameaÃ§as de 2025.

---

## ğŸ”§ Scripts de ExecuÃ§Ã£o

**Execute para validaÃ§Ã£o automatizada:**

| Script | PropÃ³sito | Uso |
|--------|-----------|-----|
| `scripts/security_scan.py` | Validar princÃ­pios de seguranÃ§a aplicados | `python scripts/security_scan.py <caminho_projeto>` |

## ğŸ“‹ Arquivos de ReferÃªncia

| Arquivo | PropÃ³sito |
|---------|-----------|
| [checklists.md](checklists.md) | Checklists de OWASP Top 10, Auth, API, ProteÃ§Ã£o de Dados |

---

## 1. Mentalidade de Especialista em SeguranÃ§a

### PrincÃ­pios Core

| PrincÃ­pio | AplicaÃ§Ã£o |
|-----------|-----------|
| **Presuma a InvasÃ£o** | Projete como se o atacante jÃ¡ estivesse dentro |
| **Zero Trust** | Nunca confie, sempre verifique |
| **Defesa em Profundidade** | MÃºltiplas camadas, sem ponto Ãºnico de falha |
| **PrivilÃ©gio MÃ­nimo** | Apenas o acesso mÃ­nimo necessÃ¡rio |
| **Falha Segura** | No erro, negue o acesso |

### Perguntas de Modelagem de AmeaÃ§as

Antes de escanear, pergunte:
1. O que estamos protegendo? (Ativos)
2. Quem atacaria? (Atores de ameaÃ§a)
3. Como eles atacariam? (Vetores de ataque)
4. Qual Ã© o impacto? (Risco de negÃ³cio)

---

## 2. OWASP Top 10:2025

### Categorias de Risco

| Rank | Categoria | Pense Sobre |
|------|-----------|-------------|
| **A01** | Controle de Acesso Quebrado | Quem pode acessar o quÃª? IDOR, SSRF |
| **A02** | ConfiguraÃ§Ã£o Incorreta de SeguranÃ§a | PadrÃµes, headers, serviÃ§os expostos |
| **A03** | Cadeia de Suprimentos de Software ğŸ†• | DependÃªncias, CI/CD, integridade do build |
| **A04** | Falhas CriptogrÃ¡ficas | Cripto fraca, segredos expostos |
| **A05** | InjeÃ§Ã£o | Entrada do usuÃ¡rio â†’ comandos do sistema |
| **A06** | Design Inseguro | Arquitetura falha |
| **A07** | Falhas de AutenticaÃ§Ã£o | SessÃ£o, gerenciamento de credenciais |
| **A08** | Falhas de Integridade | AtualizaÃ§Ãµes nÃ£o assinadas, dados adulterados |
| **A09** | Log e Alerta | Pontos cegos, sem monitoramento |
| **A10** | CondiÃ§Ãµes Excepcionais ğŸ†• | Tratamento de erro, estados de falha aberta |

### MudanÃ§as Chave em 2025

```
MudanÃ§as 2021 â†’ 2025:
â”œâ”€â”€ SSRF mesclado com A01 (Controle de Acesso)
â”œâ”€â”€ A02 elevado (ConfiguraÃ§Ãµes Cloud/Container)
â”œâ”€â”€ A03 NOVO: Cadeia de Suprimentos (foco principal)
â”œâ”€â”€ A10 NOVO: CondiÃ§Ãµes Excepcionais
â””â”€â”€ Foco: Causas raÃ­zes > Sintomas
```

---

## 3. SeguranÃ§a da Cadeia de Suprimentos (A03)

### SuperfÃ­cie de Ataque

| Vetor | Risco | Pergunta para Fazer |
|-------|-------|----------------------|
| **DependÃªncias** | Pacotes maliciosos | Auditamos novas dependÃªncias? |
| **Lock files** | Ataques de integridade | Eles estÃ£o no commit? |
| **Build pipeline** | Comprometimento do CI/CD | Quem pode modificar? |
| **Registry** | Typosquatting | Fontes verificadas? |

### PrincÃ­pios de Defesa

- Verificar integridade de pacotes (checksums)
- Fixar (pin) versÃµes, auditar atualizaÃ§Ãµes
- Usar registros privados para dependÃªncias crÃ­ticas
- Assinar e verificar artefatos

---

## 4. Mapeamento da SuperfÃ­cie de Ataque

### O que Mapear

| Categoria | Elementos |
|-----------|-----------|
| **Pontos de Entrada** | APIs, formulÃ¡rios, uploads de arquivos |
| **Fluxos de Dados** | Entrada â†’ Processamento â†’ SaÃ­da |
| **Fronteiras de ConfianÃ§a** | Onde auth/authz sÃ£o verificados |
| **Ativos** | Segredos, PII (Dados Pessoais), dados de negÃ³cio |

### Matriz de PriorizaÃ§Ã£o

```
Risco = Probabilidade Ã— Impacto

Alto Impacto + Alta Probabilidade â†’ CRÃTICO
Alto Impacto + Baixa Probabilidade â†’ ALTO
Baixo Impacto + Alta Probabilidade â†’ MÃ‰DIO
Baixo Impacto + Baixa Probabilidade â†’ BAIXO
```

---

## 5. PriorizaÃ§Ã£o de Risco

### CVSS + Contexto

| Fator | Peso | Pergunta |
|-------|------|----------|
| **Score CVSS** | Severidade base | QuÃ£o severa Ã© a vulnerabilidade? |
| **Score EPSS** | Probabilidade de exploit | EstÃ¡ sendo explorada ativamente? |
| **Valor do Ativo** | Contexto de negÃ³cio | O que estÃ¡ em risco? |
| **ExposiÃ§Ã£o** | SuperfÃ­cie de ataque | Voltado para a internet? |

### Ãrvore de DecisÃ£o de PriorizaÃ§Ã£o

```
EstÃ¡ sendo explorada ativamente (EPSS > 0.5)?
â”œâ”€â”€ SIM â†’ CRÃTICO: AÃ§Ã£o imediata
â””â”€â”€ NÃƒO â†’ Verificar CVSS
         â”œâ”€â”€ CVSS â‰¥ 9.0 â†’ ALTO
         â”œâ”€â”€ CVSS 7.0-8.9 â†’ Considerar valor do ativo
         â””â”€â”€ CVSS < 7.0 â†’ Agendar para depois
```

---

## 6. CondiÃ§Ãµes Excepcionais (A10 - Novo)

### Falha Aberta vs Falha Fechada

| CenÃ¡rio | Falha Aberta (RUIM) | Falha Fechada (BOA) |
|---------|---------------------|----------------------|
| Erro de Auth | Permitir acesso | Negar acesso |
| Falha no Parse | Aceitar entrada | Rejeitar entrada |
| Timeout | Tentar para sempre | Limitar + abortar |

### O que Verificar

- Exception handlers que capturam tudo e ignoram (catch-all)
- Falta de tratamento de erro em operaÃ§Ãµes de seguranÃ§a
- CondiÃ§Ãµes de corrida (race conditions) em auth/authz
- CenÃ¡rios de exaustÃ£o de recursos

---

## 7. Metodologia de Escaneamento

### Abordagem Baseada em Fases

```
1. RECONHECIMENTO (Reconnaissance)
   â””â”€â”€ Entender o alvo
       â”œâ”€â”€ Stack tecnolÃ³gica
       â”œâ”€â”€ Pontos de entrada
       â””â”€â”€ Fluxos de dados

2. DESCOBERTA
   â””â”€â”€ Identificar problemas potenciais
       â”œâ”€â”€ RevisÃ£o de configuraÃ§Ã£o
       â”œâ”€â”€ AnÃ¡lise de dependÃªncias
       â””â”€â”€ Busca por padrÃµes de cÃ³digo

3. ANÃLISE
   â””â”€â”€ Validar e priorizar
       â”œâ”€â”€ EliminaÃ§Ã£o de falsos positivos
       â”œâ”€â”€ PontuaÃ§Ã£o de risco
       â””â”€â”€ Mapeamento da cadeia de ataque

4. RELATÃ“RIO
   â””â”€â”€ Descobertas acionÃ¡veis
       â”œâ”€â”€ Passos claros de reproduÃ§Ã£o
       â”œâ”€â”€ Impacto de negÃ³cio
       â””â”€â”€ OrientaÃ§Ã£o para remediaÃ§Ã£o
```

---

## 8. AnÃ¡lise de PadrÃ£o de CÃ³digo

### PadrÃµes de Alto Risco

| PadrÃ£o | Risco | O que buscar |
|--------|-------|--------------|
| **Concat de strings em queries** | InjeÃ§Ã£o | `"SELECT * FROM " + user_input` |
| **ExecuÃ§Ã£o dinÃ¢mica de cÃ³digo** | RCE | `eval()`, `exec()`, `Function()` |
| **DesserializaÃ§Ã£o insegura** | RCE | `pickle.loads()`, `unserialize()` |
| **ManipulaÃ§Ã£o de caminho** | Traversal | Entrada do usuÃ¡rio em caminhos de arquivo |
| **SeguranÃ§a desativada** | Diversos | `verify=False`, `--insecure` |

### PadrÃµes de Segredos (Secrets)

| Tipo | Indicadores |
|------|-------------|
| Chaves de API | `api_key`, `apikey`, falta de entropia |
| Tokens | `token`, `bearer`, `jwt` |
| Credenciais | `password`, `secret`, `key` |
| Cloud | prefixos `AWS_`, `AZURE_`, `GCP_` |

---

## 9. ConsideraÃ§Ãµes de SeguranÃ§a em Nuvem

### Responsabilidade Compartilhada

| Camada | VocÃª Ã© Dono | Provedor Ã© Dono |
|--------|-------------|-----------------|
| Dados | âœ… | âŒ |
| AplicaÃ§Ã£o | âœ… | âŒ |
| SO/Runtime | Depende | Depende |
| Infraestrutura | âŒ | âœ… |

### VerificaÃ§Ãµes EspecÃ­ficas de Nuvem

- IAM: PrivilÃ©gio mÃ­nimo aplicado?
- Storage: Buckets pÃºblicos?
- Rede: Grupos de seguranÃ§a restritos?
- Segredos: Usando gerenciador de segredos (secrets manager)?

---

## 10. Anti-PadrÃµes

| âŒ NÃƒO FAÃ‡A | âœ… FAÃ‡A |
|-------------|---------|
| Escanear sem entender | Mapear superfÃ­cie de ataque primeiro |
| Alertar para cada CVE | Priorizar por explorabilidade + ativo |
| Ignorar falsos positivos | Manter base verificada |
| Corrigir apenas sintomas | Tratar as causas raÃ­zes |
| Escanear uma vez antes do deploy | Escaneamento contÃ­nuo |
| Confiar cegamente em terceiros | Verificar integridade, auditar cÃ³digo |

---

## 11. PrincÃ­pios de RelatÃ³rio

### Estrutura da Descoberta

Cada descoberta deve responder:
1. **O quÃª?** - DescriÃ§Ã£o clara da vulnerabilidade
2. **Onde?** - LocalizaÃ§Ã£o exata (arquivo, linha, endpoint)
3. **Por que?** - ExplicaÃ§Ã£o da causa raiz
4. **Impacto?** - ConsequÃªncia de negÃ³cio
5. **Como corrigir?** - RemediaÃ§Ã£o especÃ­fica

### ClassificaÃ§Ã£o de Severidade

| Severidade | CritÃ©rio |
|------------|----------|
| **CrÃ­tica** | RCE, bypass de auth, exposiÃ§Ã£o em massa de dados |
| **Alta** | ExposiÃ§Ã£o de dados, escalonamento de privilÃ©gios |
| **MÃ©dia** | Escopo limitado, requer condiÃ§Ãµes especÃ­ficas |
| **Baixa** | Informativo, melhor prÃ¡tica |

---

> **Lembre-se:** O escaneamento de vulnerabilidades encontra problemas. O pensamento especialista prioriza o que importa. Sempre pergunte: "O que um atacante faria com isso?"
